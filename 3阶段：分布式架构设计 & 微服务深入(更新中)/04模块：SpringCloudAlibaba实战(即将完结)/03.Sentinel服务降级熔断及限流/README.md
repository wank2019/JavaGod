# SentinelæœåŠ¡é™çº§ç†”æ–­åŠé™æµ

## è¯´åœ¨å‰é¢

>**æœ¬ç« ç›¸å…³ä»£ç åŠç¬”è®°åœ°å€ï¼š**[**é£æœºç¥¨ğŸš€**](https://github.com/EayonLee/JavaGod)
>
>ğŸŒGithubï¼š[ğŸš€Javaè¶…ç¥ä¹‹è·¯ï¼šã€ğŸ”Javaå…¨ç”Ÿæ€æŠ€æœ¯å­¦ä¹ ç¬”è®°ï¼Œä¸€èµ·è¶…ç¥å§ğŸ”ã€‘](https://github.com/EayonLee/JavaGod)<br>
>ğŸªCSDNï¼š[ğŸš€Javaè¶…ç¥ä¹‹è·¯ï¼šã€ğŸ”Javaå…¨ç”Ÿæ€æŠ€æœ¯å­¦ä¹ ç¬”è®°ï¼Œä¸€èµ·è¶…ç¥å§ğŸ”ã€‘](https://blog.csdn.net/qq_20492277/article/details/114269863)

## ç›®å½•
- [SentinelæœåŠ¡é™çº§ç†”æ–­åŠé™æµ](#sentinelæœåŠ¡é™çº§ç†”æ–­åŠé™æµ)
  - [è¯´åœ¨å‰é¢](#è¯´åœ¨å‰é¢)
  - [ç›®å½•](#ç›®å½•)
  - [ä¸€. å¾®æœåŠ¡çº§è”æ•…éšœæœåŠ¡é›ªå´©](#ä¸€-å¾®æœåŠ¡çº§è”æ•…éšœæœåŠ¡é›ªå´©)
  - [äºŒ. Sentinelæ¦‚è¦](#äºŒ-sentinelæ¦‚è¦)
    - [2.1 ç®€ä»‹](#21-ç®€ä»‹)
  - [ä¸‰. Sentineléƒ¨ç½²åŠæ¥å…¥](#ä¸‰-sentineléƒ¨ç½²åŠæ¥å…¥)
    - [3.1 Sentinel-Dashboardæ§åˆ¶å°éƒ¨ç½²](#31-sentinel-dashboardæ§åˆ¶å°éƒ¨ç½²)
      - [3.1.1 ä¸‹è½½](#311-ä¸‹è½½)
      - [3.1.2 éƒ¨ç½²](#312-éƒ¨ç½²)
    - [3.2 é¡¹ç›®å¦‚ä½•æ¥å…¥Sentinel](#32-é¡¹ç›®å¦‚ä½•æ¥å…¥sentinel)
      - [3.2.1 æ·»åŠ ä¾èµ–](#321-æ·»åŠ ä¾èµ–)
      - [3.2.2 é…ç½®æ–‡ä»¶](#322-é…ç½®æ–‡ä»¶)
      - [3.2.3 æµ‹è¯•](#323-æµ‹è¯•)
  - [å››. SentinelåŸºç¡€ä½¿ç”¨](#å››-sentinelåŸºç¡€ä½¿ç”¨)
    - [4.1 æµæ§è§„åˆ™](#41-æµæ§è§„åˆ™)
      - [4.1.1 åŸºç¡€ä½¿ç”¨ä»‹ç»](#411-åŸºç¡€ä½¿ç”¨ä»‹ç»)
      - [4.1.2 å®ç°QPSé™æµ](#412-å®ç°qpsé™æµ)
      - [4.1.3 è‡ªå®šä¹‰é™æµå“åº”ç»“æœ](#413-è‡ªå®šä¹‰é™æµå“åº”ç»“æœ)
      - [4.1.4 è‡ªå®šä¹‰é™æµè·³è½¬é¡µé¢](#414-è‡ªå®šä¹‰é™æµè·³è½¬é¡µé¢)
      - [4.1.5 æµæ§æ¨¡å¼ï¼šç›´æ¥æµæ§](#415-æµæ§æ¨¡å¼ç›´æ¥æµæ§)
      - [4.1.6 æµæ§æ¨¡å¼ï¼šå…³è”æµæ§](#416-æµæ§æ¨¡å¼å…³è”æµæ§)
      - [4.1.7 æµæ§æ¨¡å¼ï¼šé“¾è·¯æµæ§](#417-æµæ§æ¨¡å¼é“¾è·¯æµæ§)
      - [4.1.8 æµæ§æ•ˆæœï¼šWarm Upé¢„çƒ­æ¨¡å¼](#418-æµæ§æ•ˆæœwarm-upé¢„çƒ­æ¨¡å¼)
      - [4.1.9 æµæ§æ•ˆæœï¼šæ’é˜Ÿç­‰å¾…](#419-æµæ§æ•ˆæœæ’é˜Ÿç­‰å¾…)
    - [4.2 é™çº§è§„åˆ™](#42-é™çº§è§„åˆ™)
      - [4.2.1 æ…¢è°ƒç”¨æ¯”ä¾‹](#421-æ…¢è°ƒç”¨æ¯”ä¾‹)
      - [4.2.2 å¼‚å¸¸æ¯”ä¾‹](#422-å¼‚å¸¸æ¯”ä¾‹)
      - [4.2.3 å¼‚å¸¸æ•°](#423-å¼‚å¸¸æ•°)
    - [4.3 çƒ­ç‚¹è§„åˆ™](#43-çƒ­ç‚¹è§„åˆ™)
    - [4.4 ç³»ç»Ÿä¿æŠ¤è§„åˆ™](#44-ç³»ç»Ÿä¿æŠ¤è§„åˆ™)
    - [4.5 æˆæƒè§„åˆ™](#45-æˆæƒè§„åˆ™)
  - [äº”. Sentinel Dashboardæ§åˆ¶å°é€šä¿¡åŸç†](#äº”-sentinel-dashboardæ§åˆ¶å°é€šä¿¡åŸç†)
  - [å…­. Sentinelä¸¤ç§ä¿æŠ¤åº”ç”¨çš„æ–¹å¼](#å…­-sentinelä¸¤ç§ä¿æŠ¤åº”ç”¨çš„æ–¹å¼)
    - [6.1 ï¼ˆé»˜è®¤ï¼‰æ‹¦æˆªæ‰€æœ‰controllerçš„è¯·æ±‚urlè·¯å¾„](#61-é»˜è®¤æ‹¦æˆªæ‰€æœ‰controllerçš„è¯·æ±‚urlè·¯å¾„)
    - [6.2 é€šè¿‡æ³¨è§£ä¿æŠ¤åº”ç”¨**](#62-é€šè¿‡æ³¨è§£ä¿æŠ¤åº”ç”¨)
  - [ä¸ƒ. Sentinelæ•´åˆå¾®æœåŠ¡è°ƒç”¨](#ä¸ƒ-sentinelæ•´åˆå¾®æœåŠ¡è°ƒç”¨)
    - [7.1 Sentinelæ•´åˆRestTemplate](#71-sentinelæ•´åˆresttemplate)
    - [7.2 Sentinelæ•´åˆFeign](#72-sentinelæ•´åˆfeign)
      - [7.2.1 æ–¹å¼ä¸€ï¼šfallbacké™æµé™çº§å¤„ç†ç±»](#721-æ–¹å¼ä¸€fallbacké™æµé™çº§å¤„ç†ç±»)
      - [7.2.2 æ–¹å¼äºŒï¼šfallbackFactoryå·¥å‚](#722-æ–¹å¼äºŒfallbackfactoryå·¥å‚)
  - [å…«. SentinelæŒä¹…åŒ–](#å…«-sentinelæŒä¹…åŒ–)
    - [8.1 pullæ¨¡å¼æŒä¹…åŒ–åˆ°æœ¬åœ°æ–‡ä»¶](#81-pullæ¨¡å¼æŒä¹…åŒ–åˆ°æœ¬åœ°æ–‡ä»¶)
    - [8.2 pushæ¨¡å¼æŒä¹…åŒ–åˆ°Nacosï¼ˆç”Ÿäº§æ¨èï¼‰](#82-pushæ¨¡å¼æŒä¹…åŒ–åˆ°nacosç”Ÿäº§æ¨è)

## ä¸€. å¾®æœåŠ¡çº§è”æ•…éšœæœåŠ¡é›ªå´©

åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé‡Œï¼Œè®¸å¤šæœåŠ¡ä¹‹é—´é€šè¿‡è¿œç¨‹è°ƒç”¨å®ç°ä¿¡æ¯äº¤äº’ï¼Œè°ƒç”¨æ—¶ä¸å¯é¿å…ä¼šå‡ºç°è°ƒç”¨å¤±è´¥ï¼Œæ¯”å¦‚è¶…æ—¶ã€å¼‚å¸¸ç­‰åŸå› å¯¼è‡´è°ƒç”¨å¤±è´¥ï¼ŒSentinelèƒ½å¤Ÿä¿è¯åœ¨ä¸€ä¸ªæœåŠ¡å‡ºé—®é¢˜çš„æƒ…å†µä¸‹ï¼Œä¸ä¼šå¯¼è‡´æ•´ä½“æœåŠ¡å¤±è´¥ï¼Œé¿å…çº§è”æ•…éšœï¼ˆæœåŠ¡é›ªå´©ï¼‰ï¼Œä»¥æé«˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¼¹æ€§ï¼›

**æœåŠ¡é›ªå´©ä¸¾ä¾‹**ï¼š

æ¯”å¦‚ç”µå•†ä¸­çš„ç”¨æˆ·ä¸‹è®¢å•ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªæœåŠ¡ï¼Œä¸€ä¸ªä¸‹è®¢å•æœåŠ¡ï¼Œä¸€ä¸ªå‡åº“å­˜æœåŠ¡ï¼Œå½“ç”¨æˆ·ä¸‹è®¢å•æ—¶è°ƒç”¨ä¸‹è®¢å•æœåŠ¡ï¼Œç„¶åä¸‹è®¢å•æœåŠ¡åˆè°ƒç”¨å‡åº“å­˜æœåŠ¡ï¼Œå¦‚æœå‡åº“å­˜æœåŠ¡å“åº”å»¶è¿Ÿæˆ–è€…æ²¡æœ‰å“åº”ï¼Œåˆ™ä¼šé€ æˆä¸‹è®¢å•æœåŠ¡çš„çº¿ç¨‹æŒ‚èµ·ç­‰å¾…ï¼Œå¦‚æœå¤§é‡çš„ç”¨æˆ·è¯·æ±‚ä¸‹è®¢å•ï¼Œæˆ–å¯¼è‡´å¤§é‡çš„è¯·æ±‚å †ç§¯ï¼Œå¼•èµ·ä¸‹è®¢å•æœåŠ¡ä¹Ÿä¸å¯ç”¨ï¼Œå¦‚æœè¿˜æœ‰å¦å¤–ä¸€ä¸ªæœåŠ¡ä¾èµ–äºè®¢å•æœåŠ¡ï¼Œæ¯”å¦‚ç”¨æˆ·æœåŠ¡ï¼Œå®ƒéœ€è¦æŸ¥è¯¢ç”¨æˆ·è®¢å•ï¼Œé‚£ä¹ˆç”¨æˆ·æœåŠ¡æŸ¥è¯¢è®¢å•ä¹Ÿä¼šå¼•èµ·å¤§é‡çš„å»¶è¿Ÿå’Œè¯·æ±‚å †ç§¯ï¼Œå¯¼è‡´ç”¨æˆ·æœåŠ¡ä¹Ÿä¸å¯ç”¨ã€‚

æ‰€ä»¥åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œå¾ˆå®¹æ˜“é€ æˆæœåŠ¡æ•…éšœçš„è”“å»¶ï¼Œå¼•å‘æ•´ä¸ªå¾®æœåŠ¡ç³»ç»Ÿç˜«ç—ªä¸å¯ç”¨ã€‚

**å¸¸ç”¨çš„å®¹é”™æ–¹æ¡ˆæˆ–æ€æƒ³**ï¼š

- è¶…æ—¶ï¼Œè®¾ç½®æ¯”è¾ƒçŸ­çš„è¶…æ—¶æ—¶é—´ï¼Œè°ƒç”¨ä¸æˆåŠŸï¼Œå¾ˆçŸ­æ—¶é—´å°±é‡Šæ”¾çº¿ç¨‹ï¼Œé¿å…å¤§é‡çº¿ç¨‹å µå¡ç­‰å¾…ï¼Œå¯¼è‡´æœåŠ¡cpuã€å†…å­˜ç­‰èµ„æºé£™é«˜ï¼›(å¿«é€Ÿå¤±è´¥)
- é™æµï¼Œè¶…è¿‡è®¾ç½®çš„é˜ˆå€¼å°±æ‹’ç»ï¼Œæ¯”å¦‚è¯„ä¼°ç³»ç»Ÿçš„QPSæ˜¯3000ï¼Œé‚£ä¹ˆå°±å¯ä»¥è®¾ç½®é™æµé˜ˆå€¼æ˜¯2800ï¼›
- ä»“å£ä¿æŠ¤ï¼Œå°±æ˜¯ä¸€è‰˜èˆ¹ä¸æ˜¯ä¸€ä¸ªèˆ¹èˆ±ï¼Œè€Œæ˜¯æŠŠä¸€ä¸ªèˆ¹èˆ±åˆ’åˆ†ä¸ºå¤šä¸ªèˆ¹èˆ±ï¼ŒæŸä¸ªèˆ¹èˆ±è¿›æ°´äº†ï¼Œå…¶ä»–èˆ¹èˆ±éƒ½ä¸å—åˆ°å½±å“ï¼›
- æ–­è·¯å™¨ï¼Œç†”æ–­å™¨ä¹Ÿæœ‰å«æ–­è·¯å™¨ï¼Œä»–ä»¬è¡¨ç¤ºåŒä¸€ä¸ªæ„æ€ï¼Œæœ€æ—©æ¥æºäºå¾®æœåŠ¡ä¹‹çˆ¶ Martin Fowler çš„è®ºæ–‡ CircuitBreaker ä¸€æ–‡ï¼Œâ€œç†”æ–­å™¨â€æœ¬èº«æ˜¯ä¸€ç§å¼€å…³è£…ç½®ï¼Œç”¨äºåœ¨ç”µè·¯ä¸Šä¿æŠ¤çº¿è·¯è¿‡è½½ï¼Œå½“çº¿è·¯ä¸­æœ‰ç”µå™¨å‘ç”ŸçŸ­è·¯æ—¶ï¼Œèƒ½å¤ŸåŠæ—¶åˆ‡æ–­æ•…éšœç”µè·¯ï¼Œé˜²æ­¢å‘ç”Ÿè¿‡è½½ã€å‘çƒ­ç”šè‡³èµ·ç«ç­‰ä¸¥é‡åæœã€‚

## äºŒ. Sentinelæ¦‚è¦

### 2.1 ç®€ä»‹

Sentinelï¼šé˜¿é‡Œå·´å·´å¼€æºçš„è½»é‡çº§çš„æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§Java ç»„ä»¶ï¼Œæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„æµé‡é˜²å«å…µï¼›

![image-20210609181159854](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609181159854.png)

éšç€å¾®æœåŠ¡çš„æµè¡Œï¼ŒæœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„è°ƒç”¨ç¨³å®šæ€§å˜å¾—è¶Šæ¥è¶Šé‡è¦ï¼›

- å½“æœåŠ¡è®¿é—®é‡è¾¾åˆ°ä¸€å®šç¨‹åº¦ï¼Œæµé‡æ‰›ä¸ä½çš„æ—¶å€™ï¼Œè¯¥å¦‚ä½•å¤„ç†ï¼Ÿ
- æœåŠ¡ä¹‹é—´ç›¸äº’ä¾èµ–ï¼Œå½“æœåŠ¡Aå‡ºç°å“åº”æ—¶é—´è¿‡é•¿ï¼Œå½±å“åˆ°æœåŠ¡Bçš„å“åº”ï¼Œè¿›è€Œäº§ç”Ÿè¿é”ååº”ï¼Œç›´è‡³å½±å“æ•´ä¸ªä¾èµ–é“¾ä¸Šçš„æ‰€æœ‰æœåŠ¡ï¼Œè¯¥å¦‚ä½•å¤„ç†ï¼Ÿ

è¿™æ˜¯åˆ†å¸ƒå¼ã€å¾®æœåŠ¡å¼€å‘ä¸å¯é¿å…çš„é—®é¢˜ï¼ŒSentinelä»¥æµé‡ä¸ºåˆ‡å…¥ç‚¹ï¼Œä»æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ç­‰å¤šä¸ªç»´åº¦ä¿æŠ¤æœåŠ¡çš„ç¨³å®šæ€§ï¼›

**Sentinelä¸»è¦ç»„æˆ**

1. æ ¸å¿ƒåº“ï¼ˆJava å®¢æˆ·ç«¯ï¼‰ï¼šSentinelçš„æ ¸å¿ƒåº“ä¸ä¾èµ–ä»»ä½•ç¬¬ä¸‰æ–¹æ¡†æ¶/åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Javaç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / SpringBoot / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰å¾ˆå¥½çš„æ”¯æŒï¼›
2. æ§åˆ¶å°ï¼ˆDashboardï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ï¼›

## ä¸‰. Sentineléƒ¨ç½²åŠæ¥å…¥

### 3.1 Sentinel-Dashboardæ§åˆ¶å°éƒ¨ç½²

Sentinel æ§åˆ¶å°æ˜¯æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§è§„åˆ™ç»Ÿä¸€é…ç½®å’Œç®¡ç†çš„å…¥å£ï¼Œå®ƒä¸ºç”¨æˆ·æä¾›äº†æœºå™¨è‡ªå‘ç°ã€ç°‡ç‚¹é“¾è·¯è‡ªå‘ç°ã€ç›‘æ§ã€è§„åˆ™é…ç½®ç­‰åŠŸèƒ½ã€‚åœ¨ Sentinel æ§åˆ¶å°ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é…ç½®è§„åˆ™å¹¶å®æ—¶æŸ¥çœ‹æµé‡æ§åˆ¶æ•ˆæœã€‚

#### 3.1.1 ä¸‹è½½

Sentinel Githubåœ°å€ï¼šhttps://github.com/alibaba/Sentinel

![image-20210609181232686](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609181232686.png)

è¿›å…¥æœ€æ–°ç‰ˆæœ¬

![image-20210609181246816](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609181246816.png)

ä¸‹è½½Sentinel-Dashboardçš„jaråŒ…

#### 3.1.2 éƒ¨ç½²

**æ³¨æ„**ï¼šsentinelæ§åˆ¶å°éœ€è¦åœ¨JDK 1.8+çš„ç‰ˆæœ¬ä¸Šè¿è¡Œã€‚

**ä¸Šä¼ sentinel-dashboard.jaråˆ°æœåŠ¡å™¨**

![image-20210609181302033](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609181302033.png)

**ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯åŠ¨**

```shell
java -Dserver.port=19090 -Dcsp.sentinel.dashboard.server=localhost:19090 -Dproject.name=sentinel-dashboard -jar /opt/sentinel-dashboard/sentinel-dashboard-1.8.1.jar &
```

``å…¶ä¸­ -Dserver.port=19090 ç”¨äºæŒ‡å®š Sentinel æ§åˆ¶å°ç«¯å£ä¸º 19090ã€‚ï¼ˆå¦‚æœä¸æŒ‡å®šç«¯å£é»˜è®¤ä¸º8080ï¼‰``

**ç™»å½•æµ‹è¯•**

é»˜è®¤è´¦å·å¯†ç éƒ½æ˜¯ï¼š``sentinel``

![image-20210609181349133](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609181349133.png)

### 3.2 é¡¹ç›®å¦‚ä½•æ¥å…¥Sentinel

#### 3.2.1 æ·»åŠ ä¾èµ–

ç»™æ¶ˆè´¹è€…æ·»åŠ è¯¥ä¾èµ–å°±å¯ä»¥é’ˆå¯¹æ¶ˆè´¹è€…è®¿é—®è¿›è¡Œæµé‡è§„åˆ™é…ç½®

ç»™æä¾›è€…æ·»åŠ è¯¥ä¾èµ–å°±å¯ä»¥é’ˆå¯¹æ¶ˆè´¹è€…è®¿é—®æä¾›è€…æ—¶è¿›è¡Œæµé‡è§„åˆ™é…ç½®

é‚£ä¹ˆæˆ‘è¿™é‡Œåœ¨æ¶ˆè´¹è€…å’Œæä¾›è€…éƒ½åŠ å…¥è¯¥ä¾èµ–

```yaml
<!--sentinel-æœåŠ¡é™çº§ç†”æ–­åŠé™æµ-->
<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-alibaba-sentinel</artifactId>
</dependency>
```

#### 3.2.2 é…ç½®æ–‡ä»¶

é‚£ä¹ˆæˆ‘è¿™é‡Œåœ¨æ¶ˆè´¹è€…å’Œæä¾›è€…éƒ½åŠ å…¥è¯¥é…ç½®

```yaml
#æŒ‡å®šsentinel-dashboardæ§åˆ¶å°çš„è¿æ¥åœ°å€
spring.cloud.sentinel.transport.dashboard=172.17.70.29:19090
```

å¦‚ä¸‹åªæ¼”ç¤ºäº†æ·»åŠ æ¶ˆè´¹è€…çš„é…ç½®ï¼Œæä¾›è€…åŒç†è‡ªè¡Œé…ç½®

![image-20210609181454008](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609181454008.png)

#### 3.2.3 æµ‹è¯•

å°†æ¶ˆè´¹è€…å’Œæä¾›è€…é‡å¯ï¼Œç„¶åæŸ¥çœ‹sentinel-dashboardæ§åˆ¶å°

ä½†é‡å¯é¡¹ç›®ä¹‹åå…¶å®åœ¨æ§åˆ¶å°è¿˜æ˜¯çœ‹ä¸åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¿¡æ¯çš„ï¼Œ**æˆ‘ä»¬éœ€è¦è®¿é—®ä¸€ä¸‹æä¾›è€…å’Œæ¶ˆè´¹è€…çš„æ¥å£**ï¼Œè®©ä¿¡æ¯åŠ è½½åˆ°Sentinelä¸­

![image-20210609181529364](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609181529364.png)

ç”±äºæˆ‘ä»¬åˆšåˆšè®¿é—®äº†æä¾›è€…å’Œæ¶ˆè´¹è€…çš„æ¥å£ï¼Œæ‰€ä»¥åœ¨å®æ—¶ç›‘æ§é‡Œé¢åº”è¯¥æœ‰æˆ‘ä»¬çš„è¯·æ±‚ä¿¡æ¯çš„å±•ç¤ºï¼Œä½†ç°åœ¨æ˜¯æ²¡æœ‰çš„

![image-20210609181542656](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609181542656.png)

æˆ‘ä»¬æŸ¥çœ‹Sentinelçš„æ—¥å¿—å¯ä»¥å‘ç°è¿™å¯èƒ½æ˜¯sentinelæœåŠ¡ç«¯æ— æ³•é€šè¿‡``IP:8719``ç«¯å£è®¿é—®åˆ°æˆ‘ä»¬é¡¹ç›®ä¸­çš„sentinelå®¢æˆ·ç«¯ï¼Œä»è€Œæ‹‰å–ä¸åˆ°æ¥å£è®¿é—®ä¿¡æ¯ã€‚

![image-20210609181600516](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609181600516.png)

æˆ‘ä»¬çš„é¡¹ç›®æ˜¯åœ¨æœ¬åœ°ç”µè„‘ä¸Šå¯åŠ¨çš„ï¼Œé‚£æˆ‘ä»¬çœ‹ä¸€ä¸‹æ³¨å†Œåˆ°Sentinelä¸­è¯¥é¡¹ç›®çš„ IPåœ°å€å’Œç«¯å£

![image-20210609181620809](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609181620809.png)

æˆ‘ä»¬å‘ç°ç«¯å£å·æ²¡é—®é¢˜ï¼Œæ˜¯``8719ï¼ˆæ¯ä¸ªé¡¹ç›®å¯åŠ¨åé»˜è®¤åˆ†é…çš„ç«¯å£æ˜¯8719ï¼Œå¦‚æœè¯¥ç«¯å£è¢«å ç”¨åˆ™ä¼šè‡ªå¢+1 ç›´åˆ°å¯ç”¨ï¼Œæ‰€ä»¥å¦ä¸€ä¸ªæœåŠ¡çš„ç«¯å£æ˜¯8720ï¼‰``ã€‚

ä½†æ˜¯192.168.159.1 è¿™ä¸ªIPè‚¯å®šä¸æ˜¯æˆ‘ä»¬æœ¬æœºçš„IPï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹æœ¬æœºIP

![image-20210609181651757](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609181651757.png)

æ‰€ä»¥å¾ˆæ˜æ˜¾ï¼ŒsentinelæœåŠ¡ç«¯æ˜¯è®¿é—®ä¸åŒå®¢æˆ·ç«¯çš„ã€‚

**è§£å†³ï¼š**

æŒ‡å®šé¡¹ç›®çš„Sentinelå®¢æˆ·ç«¯IPåœ°å€

![image-20210609181708130](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609181708130.png)

**æŸ¥çœ‹ï¼š**

![image-20210609181720669](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609181720669.png)

æˆ‘ä»¬å†æ¬¡è®¿é—®é¡¹ç›®çš„æ¥å£ åˆ·ä¸€ç‚¹æ¥å£è¯·æ±‚ï¼Œç„¶åå†å»æŸ¥çœ‹ä¸€ä¸‹å®æ—¶ç›‘æ§æ˜¯å¦å±•ç¤ºæ•°æ®

![image-20210609181735888](C:\Users\Eayon\AppData\Roaming\Typora\typora-user-images\image-20210609181735888.png)

**æ³¨æ„**ï¼š

å¦‚æœæ˜¯æœ¬åœ°æµ‹è¯•çš„è¯å»ºè®®å°†sentinel-dashboardéƒ¨ç½²åˆ°æœ¬æœºï¼Œä¸è¦éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨æˆ–è€…è™šæ‹Ÿæœºï¼Œå› ä¸ºsentinel-dashboardéœ€è¦è¿æ¥è®¿é—®æˆ‘ä»¬é¡¹ç›®çš„IP:8719ç«¯å£å»æ‹‰å–é¡¹ç›®æ¥å£è¯·æ±‚æ•°æ®ï¼Œå¦‚æœå°†sentinel-dashboardéƒ¨ç½²åœ¨è™šæ‹Ÿæœºæˆ–è€…äº‘æœåŠ¡å™¨ä¸Šçš„è¯å®ƒè·å–åˆ°æˆ‘ä»¬æœåŠ¡çš„IPå¯èƒ½æœ‰è¯¯ï¼Œè¿™æ ·ä»äº‘æœåŠ¡å™¨æˆ–è€…è™šæ‹Ÿæœºæ˜¯è®¿é—®ä¸äº†æœ¬æœºå¯åŠ¨æœåŠ¡çš„8719ç«¯å£çš„ã€‚å°±å¯¼è‡´è™½ç„¶æœåŠ¡æ³¨å†Œåˆ°äº†sentinelï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½•è¯·æ±‚æ•°æ®çš„æƒ…å†µã€‚

æ‰€ä»¥è¿˜æ˜¯å°†æ§åˆ¶å°éƒ¨ç½²åˆ°æœ¬åœ°æ¯”è¾ƒæ–¹ä¾¿ã€‚å¦‚æœæ˜¯çº¿ä¸Šçš„è¯å°±æ²¡æœ‰é—®é¢˜ã€‚å› ä¸ºæœåŠ¡å™¨éƒ½åœ¨ä¸€ä¸ªç½‘æ®µ

**8719ç«¯å£æ˜¯ä»€ä¹ˆï¼Ÿ**

åœ¨æˆ‘ä»¬é¡¹ç›®å¼•å…¥sentinelè¿æ¥dashboardä¹‹åï¼Œä¼šé»˜è®¤ç»™è¯¥é¡¹ç›®å¼€å¯ä¸€ä¸ª8719ç«¯å£ä¾›sentinelæœåŠ¡ç«¯æ¥è®¿é—®é¡¹ç›®çš„sentinelå®¢æˆ·ç«¯æ‹‰å–è¯¥é¡¹ç›®æ¥å£è¯·æ±‚æ•°æ®ä½¿ç”¨çš„ã€‚å¦‚æœè¯¥é¡¹ç›®éƒ¨ç½²æ‰€åœ¨æœåŠ¡å™¨å·²å­˜åœ¨8719ç«¯å£ï¼Œé‚£ä¹ˆä¼šè¿›è¡Œè‡ªå¢å˜æˆ8720ï¼ŒåŒç†8720ä¹Ÿè¢«å ç”¨åˆ™ç»§ç»­è‡ªå¢ï¼Œç›´è‡³å¯ç”¨ä¸ºæ­¢ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç‰¹å®šçš„å»é…ç½®è¯¥ç«¯å£ï¼Œåªéœ€è¦çŸ¥é“å°±å¯ä»¥

## å››. SentinelåŸºç¡€ä½¿ç”¨

### 4.1 æµæ§è§„åˆ™

#### 4.1.1 åŸºç¡€ä½¿ç”¨ä»‹ç»

æˆ‘ä»¬å…ˆè®¿é—®ä¸€ä¸‹æœåŠ¡çš„æ¥å£ åˆ·ä¸€äº›è¯·æ±‚ã€‚

[http://localhost:18083/getData](http://localhost:18084/getData)2

å¯ä»¥å‘ç°æˆ‘å¯¹è¿™ä¸ª ``getData2`` æ¥å£æ¯åˆ†é’Ÿè¯·æ±‚æˆåŠŸäº†15æ¬¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å¯¹è¿™ä¸ª ``getData2`` è¯·æ±‚è¿›è¡Œæµé‡æ§åˆ¶ã€‚

![image-20210609181823556](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609181823556.png)

**æµé‡æ§åˆ¶**

![image-20210609181856709](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609181856709.png)

æ–°å¢å åœ¨å·¦ä¾§èœå•æ çš„æµæ§è§„åˆ™ä¸­å°±ä¼šæœ‰é’ˆå¯¹è¯¥æ¥å£çš„æµé‡æ§åˆ¶é…ç½®

**æµé‡æ§åˆ¶é…ç½®å‚æ•°è¯¦è§£**

- **èµ„æºåï¼š**

- - ä¸è®¾ç½®çš„è¯é»˜è®¤ä½¿ç”¨æ¥å£åç§°

- **é’ˆå¯¹æ¥æºï¼š**

- - defaultï¼šä»£è¡¨æ‰€æœ‰çš„æœåŠ¡è¿›è¡Œé™æµï¼Œä¸ç®¡ä½ æ˜¯å“ªä¸ªæœåŠ¡éƒ½ä¼šè¿›è¡Œæµé‡æ§åˆ¶

- **é˜ˆå€¼ç±»å‹ï¼š**

- - QPSé˜ˆå€¼ï¼šå¦‚æœæœåŠ¡QPSé˜ˆå€¼è®¾ç½®ä¸º2ï¼Œé‚£ä¹ˆè¡¨ç¤º1ç§’å†…è¶…è¿‡ä¸¤ä¸ªè¯·æ±‚åˆ™è¿›è¡Œé™æµ
  - çº¿ç¨‹æ•°é˜ˆå€¼ï¼šå¦‚æœæœåŠ¡çº¿ç¨‹é˜ˆå€¼è®¾ç½®ä¸º2ï¼Œé‚£ä¹ˆè¡¨ç¤º1ç§’å†…è¶…è¿‡ä¸¤ä¸ªçº¿ç¨‹åˆ™è¿›è¡Œé™æµ

- **æ˜¯å¦é›†ç¾¤ï¼š**

- - é›†ç¾¤é˜ˆå€¼æ¨¡å¼ - å•æœºå‡æ‘Šï¼šè¯¥é…ç½®å’Œä¸Šé¢çš„é˜ˆå€¼ç±»å‹æ˜¯ç›¸å…³çš„ï¼Œæ¯”å¦‚é›†ç¾¤é˜ˆå€¼æ¨¡å¼è®¾ç½®ä¸ºå•æœºå‡æ‘Šï¼Œå¹¶ä¸”ä¸Šé¢é˜ˆå€¼ç±»å‹ä¸ºQPSé˜ˆå€¼ï¼Œé˜ˆå€¼æ•°ä¸º2åˆ™è¡¨ç¤ºï¼šå•ä¸ªæœåŠ¡èŠ‚ç‚¹æ¯ç§’è¶…è¿‡ä¸¤ä¸ªè¯·æ±‚å°±é™æµ
  - é›†ç¾¤é˜ˆå€¼æ¨¡å¼ - æ€»ä½“å‡æ‘Šï¼šå¦‚é›†ç¾¤é˜ˆå€¼æ¨¡å¼è®¾ç½®ä¸º æ€»ä½“å‡æ‘Šï¼Œå¹¶ä¸”ä¸Šé¢é˜ˆå€¼ç±»å‹ä¸ºQPSé˜ˆå€¼ï¼Œé˜ˆå€¼æ•°ä¸º2åˆ™è¡¨ç¤ºï¼šæ‰€æœ‰æœåŠ¡èŠ‚ç‚¹æ¯ç§’è¶…è¿‡ä¸¤ä¸ªè¯·æ±‚å°±é™æµ

- **é«˜çº§ - æµæ§æ¨¡å¼ï¼š**

æµæ§æ¨¡å¼æ˜¯ä¸ä¸‹é¢æµæ§æ•ˆæœç›¸å…³çš„

- - ç›´æ¥ï¼šå­—é¢æ„æ€  å°±æ˜¯ç›´æ¥çš„æ„æ€ï¼Œå¦‚æœQPSé˜ˆå€¼ä¸º2å¹¶ä¸”æµæ§æ¨¡å¼ä¸ºç›´æ¥ æµæ§æ•ˆæœä¸ºå¿«é€Ÿå¤±è´¥çš„æ—¶å€™ï¼Œè¯·æ±‚äº†é«˜äºQPSé˜ˆå€¼2 åˆ™ä¼šç›´æ¥è¿”å›è®¿é—®å¤±è´¥
  - å…³è”ï¼šå…³è”æŸä¸€ä¸ªèµ„æºï¼Œä¸¾ä¾‹ï¼šå½“å‰getData2èµ„æºå…³è”äº†getData3èµ„æºåï¼ŒgetData3æ¥å£èµ„æºçš„å•æœºQPSé˜ˆå€¼è¾¾åˆ°äº†è®¾ç½®é˜ˆå€¼ï¼Œå°†å½“å‰èµ„æºgetData2æ¥å£è¿›è¡Œé™æµ
  - é“¾è·¯ï¼šè®°å½•æŒ‡å®šé“¾è·¯ä¸Šçš„æµé‡

- **é«˜çº§ - æµæ§æ•ˆæœ**

- - å¿«é€Ÿå¤±è´¥ï¼šç›´æ¥è¿”å›è¯·æ±‚å¤±è´¥
  - Warm Upï¼šé¢„çƒ­æ¨¡å¼æ ¹æ®coldFactorï¼ˆåŠ è½½å› å­ é»˜è®¤ä¸º3ï¼‰çš„å€¼ï¼Œæ ¹æ®å•æœºé˜ˆå€¼é™¤äºcoldFactorï¼Œç»è¿‡é¢„çƒ­çš„æ—¶é•¿è¾¾åˆ°è®¾ç½®çš„QPSé˜ˆå€¼ï¼Œæ¯”å¦‚è®¾ç½®QPSå•æœºé˜ˆå€¼ä¸º100ï¼Œé‚£ä¹ˆ100/3 =33ï¼Œç”¨33ä½œä¸ºæœ€åˆçš„é˜ˆå€¼ï¼Œç„¶ååœ¨10ç§’åˆ°è¾¾100åå†å¼€å§‹é™æµï¼›
  - æ’é˜Ÿç­‰å¾…ï¼šæ’é˜Ÿæ¨¡å¼ï¼Œåœ¨QPSé˜ˆå€¼åˆ°è¾¾åï¼Œæ–°çš„è¯·æ±‚å°±ç­‰å¾…ï¼Œç›´åˆ°è¶…æ—¶ï¼Œå¯ä»¥é€‚ç”¨äºçªå‘æµé‡çš„è¯·æ±‚ï¼›

#### 4.1.2 å®ç°QPSé™æµ

æ¯”å¦‚æˆ‘ä»¬å°†getData2æ¥å£è¿›è¡Œäº†é™æµï¼Œæµæ§è§„åˆ™å¦‚ä¸‹

![image-20210609181916372](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609181916372.png)

é‚£ä¹ˆæˆ‘ä»¬ç–¯ç‹‚è¯·æ±‚`` getData2`` æ¥å£è¿›è¡Œæµ‹è¯•

![image-20210609181935162](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609181935162.png)

ä¼šå‘ç°ï¼Œä»–ä¼šè¿”å›ç»™æˆ‘ä»¬è¯¥è¯·æ±‚è¢«é™æµçš„è­¦å‘Šï¼Œä½†æ˜¯æ—¥å¸¸å·¥ä½œä¸­æˆ‘ä»¬è‚¯å®šä¸ä¼šè¿™æ ·ç›´æ¥è¿”å›ï¼Œéœ€è¦è¿›è¡Œå¤„ç†ï¼Œå¯ä»¥çœ‹ä¸‹é¢å¦‚ä½•è¿›è¡Œå¤„ç†

#### 4.1.3 è‡ªå®šä¹‰é™æµå“åº”ç»“æœ

**åœ¨æœåŠ¡ä¸­åˆ›å»ºè‡ªå®šä¹‰é™æµé™çº§ä¿¡æ¯è¿”å›å¤„ç†ç±»**

![image-20210609181955787](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609181955787.png)

```JAVA
import com.alibaba.csp.sentinel.adapter.spring.webmvc.callback.BlockExceptionHandler;
import com.alibaba.csp.sentinel.slots.block.BlockException;
import com.alibaba.csp.sentinel.slots.block.authority.AuthorityException;
import com.alibaba.csp.sentinel.slots.block.degrade.DegradeException;
import com.alibaba.csp.sentinel.slots.block.flow.FlowException;
import com.alibaba.csp.sentinel.slots.block.flow.param.ParamFlowException;
import com.alibaba.csp.sentinel.slots.system.SystemBlockException;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.springframework.http.MediaType;
import org.springframework.stereotype.Component;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.util.HashMap;
import java.util.Map;

/**
 * @author zhengtai.li
 * @ClassName MyBlockExceptionHandler
 * @Description è‡ªå®šä¹‰é™æµé™çº§è¿”å›é”™è¯¯ä¿¡æ¯
 * @Copyright 2021 Â© kuwo.cn
 * @date 2021/5/24 18:50
 * @Version: 1.0
 */
@Component
public class MyBlockExceptionHandler implements BlockExceptionHandler{

    /**
     * é’ˆå¯¹é™æµåè¿”å›é”™è¯¯æç¤ºä¿¡æ¯
     */
    @Override
    public void handle(HttpServletRequest request, HttpServletResponse response, BlockException e) throws Exception {
        //log.info("UrlBlockHandler.....................................");
        Map restObject = new HashMap();

        // ä¸åŒçš„å¼‚å¸¸è¿”å›ä¸åŒçš„æç¤ºè¯­
        if (e instanceof FlowException) {
            restObject.put("code",100);
            restObject.put("msg","æ¥å£é™æµäº†");

        } else if (e instanceof DegradeException) {
            restObject.put("code",101);
            restObject.put("msg","æœåŠ¡é™çº§äº†");

        } else if (e instanceof ParamFlowException) {
            restObject.put("code",102);
            restObject.put("msg","çƒ­ç‚¹å‚æ•°é™æµäº†");

        } else if (e instanceof SystemBlockException) {
            restObject.put("code",103);
            restObject.put("msg","è§¦å‘ç³»ç»Ÿä¿æŠ¤è§„åˆ™");

        } else if (e instanceof AuthorityException) {
            restObject.put("code",104);
            restObject.put("msg","æˆæƒè§„åˆ™ä¸é€šè¿‡");
        }

        //è¿”å›jsonæ•°æ®
        response.setStatus(500);
        response.setCharacterEncoding("utf-8");
        response.setContentType(MediaType.APPLICATION_JSON_VALUE);
        //springmvc çš„ä¸€ä¸ªjsonè½¬æ¢ç±» ï¼ˆjacksonï¼‰
        new ObjectMapper().writeValue(response.getWriter(), restObject);
    }

}
```



é‡å¯æœåŠ¡è¿›è¡Œæµ‹è¯•

![image-20210609182019027](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609182019027.png)

#### 4.1.4 è‡ªå®šä¹‰é™æµè·³è½¬é¡µé¢

åŒæ ·è¿˜æ˜¯å¦‚ä¸Šé‚£ä¸ªå®ç°ç±»ï¼Œåªä¸è¿‡æœ€åä¸åæ‚”jsonç›¸åº”å†…å®¹äº† è€Œé‡å®šå‘é¡µé¢

```java
import com.alibaba.csp.sentinel.adapter.spring.webmvc.callback.BlockExceptionHandler;
import com.alibaba.csp.sentinel.slots.block.BlockException;
import com.alibaba.csp.sentinel.slots.block.authority.AuthorityException;
import com.alibaba.csp.sentinel.slots.block.degrade.DegradeException;
import com.alibaba.csp.sentinel.slots.block.flow.FlowException;
import com.alibaba.csp.sentinel.slots.block.flow.param.ParamFlowException;
import com.alibaba.csp.sentinel.slots.system.SystemBlockException;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.springframework.http.MediaType;
import org.springframework.stereotype.Component;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.util.HashMap;
import java.util.Map;

/**
 * @author zhengtai.li
 * @ClassName MyBlockExceptionHandler
 * @Description è‡ªå®šä¹‰é™æµé™çº§è¿”å›é”™è¯¯ä¿¡æ¯
 * @Copyright 2021 Â© kuwo.cn
 * @date 2021/5/24 18:50
 * @Version: 1.0
 */
@Component
public class MyBlockExceptionHandler implements BlockExceptionHandler {

    /**
     * é’ˆå¯¹é™æµåè¿”å›é”™è¯¯æç¤ºä¿¡æ¯
     */
    @Override
    public void handle(HttpServletRequest request, HttpServletResponse response, BlockException e) throws Exception {
        //log.info("UrlBlockHandler.....................................");
        Map restObject = new HashMap();

        // ä¸åŒçš„å¼‚å¸¸è¿”å›ä¸åŒçš„æç¤ºè¯­
        if (e instanceof FlowException) {
            restObject.put("code", 100);
            restObject.put("msg", "æ¥å£é™æµäº†");

        } else if (e instanceof DegradeException) {
            restObject.put("code", 101);
            restObject.put("msg", "æœåŠ¡é™çº§äº†");

        } else if (e instanceof ParamFlowException) {
            restObject.put("code", 102);
            restObject.put("msg", "çƒ­ç‚¹å‚æ•°é™æµäº†");

        } else if (e instanceof SystemBlockException) {
            restObject.put("code", 103);
            restObject.put("msg", "è§¦å‘ç³»ç»Ÿä¿æŠ¤è§„åˆ™");

        } else if (e instanceof AuthorityException) {
            restObject.put("code", 104);
            restObject.put("msg", "æˆæƒè§„åˆ™ä¸é€šè¿‡");
        }

        //è¿”å›jsonæ•°æ®
        //response.setStatus(500);
        //response.setCharacterEncoding("utf-8");
        //response.setContentType(MediaType.APPLICATION_JSON_VALUE);
        //springmvc çš„ä¸€ä¸ªjsonè½¬æ¢ç±» ï¼ˆjacksonï¼‰
        //new ObjectMapper().writeValue(response.getWriter(), restObject);

        request.getRequestDispatcher("/index.jsp").forward(request, response);
    }

}
```

![image-20210609182051528](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609182051528.png)

**åˆ›å»ºIndexé¡µé¢**

![image-20210609182106091](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609182106091.png)

**é‡å¯æµ‹è¯•**

![image-20210609182115862](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609182115862.png)

å¦‚æœæ˜¯å‰åç«¯åˆ†ç¦»é¡¹ç›®  æˆ‘ä»¬å¯ä»¥è®©å‰ç«¯åŒå­¦ç›´æ¥åˆ¤æ–­æˆ‘ä»¬è¿”å›çš„çŠ¶æ€ç ï¼Œç”±å‰ç«¯çš„åŒå­¦å»å†™å‰ç«¯é¡µé¢å’Œè·³è½¬çš„æ“ä½œï¼Œä¸€èˆ¬ä¹Ÿéƒ½æ˜¯è¿™æ ·å»æå¾—

#### 4.1.5 æµæ§æ¨¡å¼ï¼šç›´æ¥æµæ§

çº¿ç¨‹é˜ˆå€¼è®¾ç½®ä¸º5

![image-20210609182145862](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609182145862.png)

è¿™é‡Œéœ€è¦è¶…è¿‡5ä¸ªçº¿ç¨‹å»åŒæ—¶è®¿é—®æµ‹è¯•ï¼Œé‚£ä¹ˆæˆ‘ä»¬é€šè¿‡æµè§ˆå™¨æµ‹è¯•æ˜¯ä¸è¡Œçš„ï¼Œå¤§å®¶å¯ä»¥é€šè¿‡JMeterå»è¿›è¡Œå¤šçº¿ç¨‹è®¿é—®æµ‹è¯•ã€‚

#### 4.1.6 æµæ§æ¨¡å¼ï¼šå…³è”æµæ§

![image-20210609182216830](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609182216830.png)

å°†å½“å‰`` getData2``æ¥å£èµ„æº å’Œ ``getData3``æ¥å£èµ„æºè¿›è¡Œå…³è”ï¼Œå½“``getData3``çš„å•æœºQPSé˜ˆå€¼è¾¾åˆ°2æ—¶`` getData2``å°±ä¼šè¿›è¡Œé™æµ

#### 4.1.7 æµæ§æ¨¡å¼ï¼šé“¾è·¯æµæ§

![image-20210609182250651](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609182250651.png)

**æ³¨æ„ï¼š**

å…¥å£èµ„æºï¼š``sentinel_spring_web_context`` ä»£è¡¨çš„æ˜¯è¯¥æµæ§æ¥å£ ``getData2``çš„ä¸Šçº§ç°‡ç‚¹é“¾è·¯ï¼Œå¦‚ä¸‹å›¾

![image-20210609182322579](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609182322579.png)

**è§£é‡Šï¼š**

``sentinel_spring_web_context``è¿™ä¸ªå…¥å£èµ„æºä¸‹ä¼šæœ‰å¤šä¸ªæ¥å£èµ„æºï¼Œå¦‚ä¸Šå›¾çš„getData2å’ŒgetData3

æˆ‘ä»¬çš„æµæ§è§„åˆ™ä¸ºå½“``sentinel_spring_web_context``è¿™ä¸ªå…¥å£èµ„æºçš„å•æœºQPSé˜ˆå€¼è¾¾åˆ° 2 æ—¶ä¼šå¯¹getData2æ¥å£èµ„æºè¿›è¡Œé™æµï¼Œæµæ§æ•ˆæœä¸ºå¿«é€Ÿç°æœ‰å¤±è´¥

åªè¦æ˜¯``sentinel_spring_web_context``è¿™ä¸ªå…¥å£èµ„æºä¸‹çš„æ‰€æœ‰æ¥å£èµ„æºçš„æµé‡éƒ½ä¼šæ±‡æ€»åˆ°å…¥å£èµ„æºä¸Š

#### 4.1.8 æµæ§æ•ˆæœï¼šWarm Upé¢„çƒ­æ¨¡å¼

![image-20210609182347005](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609182347005.png)

é¢„çƒ­æ¨¡å¼æ ¹æ®coldFactorï¼ˆåŠ è½½å› å­ é»˜è®¤ä¸º3ï¼‰çš„å€¼ï¼Œæ ¹æ®å•æœºé˜ˆå€¼é™¤äºcoldFactorï¼Œç»è¿‡é¢„çƒ­çš„æ—¶é•¿è¾¾åˆ°è®¾ç½®çš„QPSé˜ˆå€¼ï¼Œæ¯”å¦‚è®¾ç½®QPSå•æœºé˜ˆå€¼ä¸º100ï¼Œé‚£ä¹ˆ100/3 =33ï¼Œç”¨33ä½œä¸ºæœ€åˆçš„é˜ˆå€¼ï¼Œç„¶ååœ¨10ç§’åˆ°è¾¾100åå†å¼€å§‹é™æµï¼›

#### 4.1.9 æµæ§æ•ˆæœï¼šæ’é˜Ÿç­‰å¾…

![image-20210609182422405](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609182422405.png)

å½“ getData2æ¥å£èµ„æºçš„å•æœºQPSé˜ˆå€¼è¾¾åˆ°2æ—¶ä¸ä¼šç›´æ¥è¿›è¡Œé™æµï¼Œè€Œæ˜¯è¿›è¡Œæ’é˜Ÿç­‰å¾…500æ¯«ç§’ï¼Œå¦‚æœè¶…è¿‡500æ¯«ç§’æœåŠ¡è¿˜æ˜¯æ— æ³•å¤„ç†æœ¬æ¬¡è¯·æ±‚åˆ™è¿›è¡Œé™æµå¤„ç†è¿”å›é”™è¯¯æç¤ºã€‚

### 4.2 é™çº§è§„åˆ™

- **å¼‚å¸¸æ¯”ä¾‹**ï¼šå¼‚å¸¸æ¯”ä¾‹ (DEGRADE_GRADE_EXCEPTION_RATIO)æ˜¯æŒ‡å½“èµ„æºçš„æ¯ç§’å¼‚å¸¸æ€»æ•°å é€šè¿‡é‡çš„æ¯”å€¼è¶…è¿‡é˜ˆå€¼ï¼ˆDegradeRule ä¸­çš„ countï¼‰ä¹‹åï¼Œèµ„æºè¿›å…¥é™çº§çŠ¶æ€ï¼Œå³åœ¨æ¥ä¸‹çš„æ—¶é—´çª—å£ï¼ˆDegradeRule ä¸­çš„ timeWindowï¼Œä»¥ s ä¸ºå•ä½ï¼‰ä¹‹å†…ï¼Œå¯¹è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨éƒ½ä¼šè‡ªåŠ¨åœ°è¿”å›ï¼Œå¼‚å¸¸æ¯”ç‡çš„é˜ˆå€¼èŒƒå›´æ˜¯ [0.0, 1.0]ï¼Œä»£è¡¨ 0% - 100%ï¼›
- **å¼‚å¸¸æ•°**ï¼šå¼‚å¸¸æ•° (DEGRADE_GRADE_EXCEPTION_COUNT)æ˜¯æŒ‡å½“èµ„æºè¿‘1åˆ†é’Ÿçš„å¼‚å¸¸æ•°ç›®è¶…è¿‡é˜ˆå€¼ä¹‹åä¼šè¿›è¡Œç†”æ–­ï¼Œæ³¨æ„ç”±äºç»Ÿè®¡æ—¶é—´çª—å£æ˜¯åˆ†é’Ÿçº§åˆ«çš„ï¼Œè‹¥timeWindowå°äº 60sï¼Œåˆ™ç»“æŸç†”æ–­çŠ¶æ€åä»å¯èƒ½å†è¿›å…¥ç†”æ–­çŠ¶æ€ï¼›

#### 4.2.1 æ…¢è°ƒç”¨æ¯”ä¾‹

![image-20210609182504692](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609182504692.png)

**æ‰§è¡Œé€»è¾‘**

æ¯”å¦‚æˆ‘å¯¹getData2èµ„æºè®¾ç½®é™çº§è§„åˆ™ï¼Œæ­¤æ—¶å¦‚æœæœåŠ¡å™¨åœ¨ç»Ÿè®¡æ—¶é•¿1000mså†…æ¥æ”¶åˆ°çš„è¯·æ±‚è¶…è¿‡æœ€å°è¯·æ±‚æ•°5æ¬¡ï¼Œå¹¶ä¸”æœ‰4æ¬¡ï¼ˆè¯¥4æ¬¡æ˜¯é€šè¿‡æ¯”ä¾‹é˜ˆå€¼å’Œæœ€å°è¯·æ±‚æ•°ç®—å‡ºæ¥çš„ï¼‰è°ƒç”¨æ—¶é—´è¶…è¿‡æœ€å¤§RT200msåˆ™è§¦å‘é™çº§ï¼Œ1så†…å¯¹èµ„æºè¿›è¡Œç†”æ–­ï¼Œè¿™1så†…è¯¥èµ„æºæ— æ³•è¢«è®¿é—®ï¼Œè®¿é—®åä¼šè¿”å›æˆ‘ä»¬è‡ªå®šä¹‰çš„é”™è¯¯å“åº”ä¿¡æ¯æˆ–é¡µé¢ã€‚

![image-20210609182522221](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609182522221.png)

#### 4.2.2 å¼‚å¸¸æ¯”ä¾‹

![image-20210609182535177](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609182535177.png)

**æ‰§è¡Œé€»è¾‘**

å¦‚æœæœåŠ¡å™¨åœ¨ç»Ÿè®¡æ—¶é•¿1000mså†…æ¥æ”¶åˆ°çš„è¯·æ±‚è¶…è¿‡æœ€å°è¯·æ±‚æ•°5ï¼Œå¹¶ä¸”æœ‰4æ¬¡ï¼ˆè¯¥4æ¬¡æ˜¯é€šè¿‡æ¯”ä¾‹é˜ˆå€¼å’Œæœ€å°è¯·æ±‚æ•°ç®—å‡ºæ¥çš„ï¼‰è¯·æ±‚å¼‚å¸¸çš„æƒ…å†µä¸‹ä¼šå¯¹è¯¥getData2è¿›è¡Œ1ç§’çš„èµ„æºç†”æ–­ï¼Œ1ç§’å†…è¯¥èµ„æºæ— æ³•è¢«è®¿é—®ï¼Œè®¿é—®åä¼šè¿”å›æˆ‘ä»¬è‡ªå®šä¹‰çš„é”™è¯¯å“åº”ä¿¡æ¯æˆ–é¡µé¢ã€‚

![image-20210609182547791](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609182547791.png)

#### 4.2.3 å¼‚å¸¸æ•°

![image-20210609182606835](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609182606835.png)

**æ‰§è¡Œé€»è¾‘**

å¦‚æœæœåŠ¡å™¨ç»Ÿè®¡æ—¶é•¿1000mså†…æ¥æ”¶åˆ°çš„è¯·æ±‚è¶…è¿‡æœ€å°è¯·æ±‚æ•°5ï¼Œå¹¶ä¸”å¼‚å¸¸æ•°è¶…è¿‡2çš„è¯ä¼šè¿›è¡Œ1ç§’çš„ç†”æ–­ï¼Œ1ç§’å†…è¯¥èµ„æºæ— æ³•è¢«è®¿é—®ï¼Œè®¿é—®åä¼šè¿”å›æˆ‘ä»¬è‡ªå®šä¹‰çš„é”™è¯¯å“åº”ä¿¡æ¯æˆ–é¡µé¢ã€‚

![image-20210609182620820](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609182620820.png)

### 4.3 çƒ­ç‚¹è§„åˆ™

ä½•ä¸ºçƒ­ç‚¹ï¼Ÿçƒ­ç‚¹å³ç»å¸¸è®¿é—®çš„æ•°æ®ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¸Œæœ›ç»Ÿè®¡æŸä¸ªçƒ­ç‚¹æ•°æ®ä¸­è®¿é—®é¢‘æ¬¡æœ€é«˜çš„ Top K æ•°æ®ï¼Œå¹¶å¯¹å…¶è®¿é—®è¿›è¡Œé™åˆ¶

**æ¯”å¦‚ï¼š**

å•†å“ ID ä¸ºå‚æ•°ï¼Œç»Ÿè®¡ä¸€æ®µæ—¶é—´å†…æœ€å¸¸è´­ä¹°çš„å•†å“ ID å¹¶è¿›è¡Œé™åˆ¶ï¼›

ç”¨æˆ· ID ä¸ºå‚æ•°ï¼Œé’ˆå¯¹ä¸€æ®µæ—¶é—´å†…é¢‘ç¹è®¿é—®çš„ç”¨æˆ· ID è¿›è¡Œé™åˆ¶ï¼›

çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµï¼Œçƒ­ç‚¹å‚æ•°é™æµå¯ä»¥çœ‹åšæ˜¯ä¸€ç§ç‰¹æ®Šçš„æµé‡æ§åˆ¶ï¼Œä»…å¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨ç”Ÿæ•ˆï¼›

**åˆ›å»ºä¸€ä¸ªæµ‹è¯•çƒ­ç‚¹å‚æ•°æ¥å£ï¼š**

![image-20210609182638466](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609182638466.png)

è¯¥æ¥å£çš„è·¯å¾„ä¸ºï¼š``/getData5``

``@SentinelResource``æ³¨è§£ä¸€å®šè¦åŠ ï¼Œå¦åˆ™çƒ­ç‚¹è§„åˆ™é™æµä¸ç”Ÿæ•ˆ

**æ³¨è§£å‚æ•°è¯¦è§£ï¼š**

- valueï¼šè¯¥valueä¼šåœ¨Sentinelä¸­ä¸ºè¯¥æ¥å£èµ„æº /getData5ç”Ÿæˆä¸€ä¸ªå­èµ„æº getData5ï¼Œä¸€èˆ¬valueå±æ€§å€¼ä¸æ¥å£è·¯å¾„ä¿æŒä¸€è‡´ï¼ˆå»æ‰æ–œæ ï¼‰ã€‚
- fallbackï¼šå½“è¯¥æ¥å£è¿›è¡Œçƒ­ç‚¹è§„åˆ™é™æµåä¼šè¿›å…¥åˆ°fallbacké™çº§å¤„ç†ç±»ï¼ˆè¿™é‡Œæ˜¯MyBlockHotFallbackï¼‰ä¸­çš„fallbackçš„é™æ€æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åå¯è‡ªè¡Œå®šä¹‰
- fallbackClassï¼šå½“è¯¥æ¥å£è¿›è¡Œçƒ­ç‚¹è§„åˆ™é™æµåä¼šè¿›å…¥åˆ°è¯¥MyBlockHotFallbacké™çº§å¤„ç†ç±»ä¸­çš„åå­—ä¸ºfallbackçš„é™æ€æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åå¯è‡ªè¡Œå®šä¹‰

**é™çº§å¤„ç†ç±»ï¼š**

![image-20210609182703885](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609182703885.png)

**æ™®é€šæµ‹è¯•**

æˆ‘ä»¬å…ˆåˆ·ä¸€ä¸‹ /getData5æ¥å£ï¼Œç„¶ååœ¨Sentinelç°‡ç‚¹é“¾è·¯ä¸­æ‰¾åˆ°è¯¥æ¥å£èµ„æº /getData5 å’Œä»–çš„å­èµ„æº getData5 ï¼Œè¿™ä¸ªgetData5èµ„æºå°±æ˜¯æ³¨è§£ä¸­valueçš„å±æ€§å€¼

![image-20210609182730365](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609182730365.png)

æˆ‘ä»¬æƒ³è¦å¯¹è¯¥æ¥å£è¿›è¡Œå‚æ•°çƒ­ç‚¹è§„åˆ™é™æµçš„è¯ åªèƒ½å¯¹é€šè¿‡``@SentinelResource``æ³¨è§£ç”Ÿæˆè¯¥æ¥å£çš„å­èµ„æºè¿›è¡Œçƒ­ç‚¹é…ç½®ï¼Œä¹Ÿå°±æ˜¯getData5èµ„æº è€Œä¸æ˜¯ /getData5ï¼ˆæ²¡æœ‰æ–œæ çš„é‚£ä¸€ä¸ªï¼‰

![image-20210609182743367](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609182743367.png)

å½“getData5èµ„æºçš„ä¸‹æ ‡ä¸º0çš„å‚æ•°åœ¨1ç§’å†…è¶…è¿‡å•æœºé˜ˆå€¼2æ¬¡çš„è®¿é—®ä¼šè¿›è¡Œé™æµ

![image-20210609182754743](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609182754743.png)

**é«˜çº§æµ‹è¯•**

![image-20210609182807722](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609182807722.png)

å½“ getData5èµ„æº ä¸‹æ ‡ä¸º0çš„å‚æ•°æ¯ç§’è¯·æ±‚è¶…è¿‡å•æœºé˜ˆå€¼5ä¼šè¿›è¡Œé™æµï¼Œå¹¶ä¸”å¦‚æœè¯¥èµ„æºä¸‹æ ‡ä¸º0çš„å‚æ•°å€¼ä¸º66çš„è¯ï¼Œæ¯ç§’è¯·æ±‚æ•°å¤§äºé™æµé˜€å€¼2ä¹Ÿä¼šè¿›è¡Œé™æµ

![image-20210609182819067](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609182819067.png)

**æ³¨æ„**ï¼š

å¦‚æœæ˜¯å¦‚ä¸‹å‚æ•°å€¼çš„é˜ˆå€¼å¤§äºå‚æ•°é˜ˆå€¼çš„æƒ…å†µ

![image-20210609182836482](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609182836482.png)

æ¯”å¦‚ä¸‹æ ‡0çš„å‚æ•°å€¼66çš„é˜ˆå€¼ä¸º100ï¼Œä¸‹æ ‡0çš„å‚æ•°çš„æ€»ä½“é˜ˆå€¼ä¸º2çš„è¯ï¼Œæˆ‘ä»¬è¯·æ±‚å‚æ•°ä¸º66æ—¶ï¼Œå®ƒæ˜¯åªä¼šèµ°ä¸‹é¢é‚£ä¸ªé…ç½®çš„ï¼Œæ‰€ä»¥åªæœ‰å½“é˜ˆå€¼è¾¾åˆ°100çš„æ—¶å€™æ‰ä¼šé™æµï¼Œåˆ°è¾¾2çš„æ—¶å€™ä¸ä¼šé™æµ

![image-20210609182848879](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609182848879.png)



### 4.4 ç³»ç»Ÿä¿æŠ¤è§„åˆ™

![image-20210609183016066](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609183016066.png)

- **LOAD**ï¼šåªæœ‰åœ¨ Linux ç³»ç»Ÿçš„æœºå™¨ä¸Šæ‰ä¼šç”Ÿæ•ˆï¼Œå¯ä»¥æ ¹æ®å½“å‰æ“ä½œç³»ç»Ÿçš„è´Ÿè½½ï¼Œæ¥å†³å®šæ˜¯å¦è§¦å‘ä¿æŠ¤ï¼ˆå¯é€šè¿‡uptimeå‘½ä»¤æŸ¥çœ‹linuxçš„è´Ÿè½½ï¼‰ï¼›
- **RT**ï¼šå½“å•å°æœºå™¨ä¸Šè¯¥åº”ç”¨æ‰€æœ‰è¯·æ±‚çš„å¹³å‡å“åº”æ—¶é—´è¾¾åˆ°é˜ˆå€¼å°±ä¼šè§¦å‘ç³»ç»Ÿä¿æŠ¤åœæ­¢æ‰€æœ‰æ¥å£è¯·æ±‚ï¼ˆé˜ˆå€¼å•ä½æ˜¯æ¯«ç§’ï¼‰
- **çº¿ç¨‹æ•°**ï¼šå½“å•å°æœºå™¨ä¸Šè¯¥åº”ç”¨ï¼Œæ‰€æœ‰çš„è¯·æ±‚æ¶ˆè€—çš„çº¿ç¨‹æ•°åŠ èµ·æ¥ï¼Œå¦‚æœè¶…è¿‡é˜ˆå€¼ï¼Œå°±åœæ­¢æ‰€æœ‰æ¥å£è¯·æ±‚ï¼ˆé˜ˆå€¼å•ä½æ˜¯ä¸ªï¼‰
- **å…¥å£ QPS**ï¼šå½“å•å°æœºå™¨ä¸Šè¯¥åº”ç”¨ï¼Œæ‰€æœ‰æ¥å£çš„ QPS åŠ èµ·æ¥ï¼Œå¦‚æœè¶…è¿‡é˜ˆå€¼ï¼Œå°±åœæ­¢æ‰€æœ‰æ¥å£è¯·æ±‚ï¼ˆé˜ˆå€¼å•ä½æ˜¯ä¸ªï¼‰
- **CPU ä½¿ç”¨ç‡**ï¼šå½“è¯¥åº”ç”¨æ‰€åœ¨æœºå™¨çš„CPUä½¿ç”¨ç‡ï¼Œå¦‚æœè¶…è¿‡é˜ˆå€¼ï¼Œå°±åœæ­¢æ‰€æœ‰æ¥å£è¯·æ±‚ï¼ˆé˜ˆå€¼å–å€¼èŒƒå›´0.0~1.0ï¼‰

å‘ç”Ÿç³»ç»Ÿè§„åˆ™ä¸­é…ç½®çš„æƒ…å†µçš„æ—¶å€™ï¼Œä¼šæŠŠæ•´ä¸ªåº”ç”¨éƒ½æ–­æ‰ï¼Œæ‰€æœ‰çš„æ¥å£å¯¹ä¸èƒ½å¯¹å¤–æä¾›æœåŠ¡äº†ï¼Œè¿™ä¸ªè®¾è®¡å¾ˆå°‘ç”¨ï¼Œå› ä¸ºç²’åº¦å¤ªå¤§äº†ï¼Œç”¨ Sentinel ä¸€èˆ¬éƒ½æ˜¯åšç»†ç²’åº¦çš„ç»´æŠ¤ï¼Œå¦‚æœè®¾ç½®äº†ç³»ç»Ÿè§„åˆ™ï¼Œå¯èƒ½è‡ªå·±éƒ½ä¸çŸ¥é“æ€ä¹ˆå›äº‹ï¼Œç³»ç»Ÿå°±ç”¨ä¸äº†äº†ï¼›

### 4.5 æˆæƒè§„åˆ™

æˆæƒè§„åˆ™å°±æ˜¯å¯ä»¥é’ˆå¯¹èµ„æºè¿›è¡Œæƒé™ç®¡ç†ï¼Œæ¯”å¦‚ /getData2è¿™ä¸ªæ¥å£èµ„æºåªå…è®¸æŸåº”ç”¨è¿›è¡Œè°ƒç”¨ï¼Œæˆ–åªä¸å…è®¸æŸåº”ç”¨è°ƒç”¨

![image-20210609183036726](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609183036726.png)

è¯·æ±‚ä¸­æºå¸¦ orderåº”ç”¨æ ‡è¯†çš„è¯·æ±‚è®¿é—® /getData2èµ„æºæ—¶è¿›è¡Œé»‘åå•é™åˆ¶ã€‚

è°ƒç”¨æ–¹å¯ä»¥åœ¨è¯·æ±‚å‚æ•°ä¸­ç›´æ¥æºå¸¦ ä»–è‡ªå·±çš„åº”ç”¨æ ‡è¯†ï¼Œä¹Ÿå¯ä»¥åœ¨è¯·æ±‚headerä¸­ä¼ é€’ã€‚

å½“ç„¶å¦‚æœè°ƒç”¨æ–¹ä¸ä¼ é€’åº”ç”¨å‚æ•°ï¼Œè€Œæä¾›è€…æ²¡æœ‰å…·ä½“é™åˆ¶å¿…ä¼ çš„è¯è°ƒç”¨ä¹Ÿæ˜¯æ²¡é—®é¢˜çš„

**åœ¨ /getData2èµ„æºæ‰€å±æœåŠ¡ä¸­æ·»åŠ è§£æåº”ç”¨æ¥æºæ¥å£**

![image-20210609183051433](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609183051433.png)

å¦‚ä¸ŠæœåŠ¡å¯ä»¥ä»è¯·æ±‚å‚æ•°ä¸­æˆ–è€…è¯·æ±‚headerä¸­è·å–ï¼Œé‚£ä¹ˆè°ƒç”¨è€…ä¹Ÿå°±æœ‰ä¸¤ç§ä¼ é€’åº”ç”¨å‚æ•°çš„æ–¹å¼ã€‚å½“ç„¶å¦‚æœè°ƒç”¨æ–¹ä¸ä¼ é€’åº”ç”¨å‚æ•°ï¼Œè€Œæä¾›è€…æ²¡æœ‰å…·ä½“é™åˆ¶å¿…ä¼ çš„è¯è°ƒç”¨ä¹Ÿæ˜¯æ²¡é—®é¢˜çš„

```java
import com.alibaba.csp.sentinel.adapter.spring.webmvc.callback.RequestOriginParser;
import org.apache.commons.lang3.StringUtils;
import org.springframework.stereotype.Component;

import javax.servlet.http.HttpServletRequest;

/**
 * @author zhengtai.li
 * @ClassName MyRequestOriginParser
 * @Description è§£ææ¥æºå¤„ç†å™¨ï¼ˆä¸»è¦ç”¨äºSentinelçš„æˆæƒè§„åˆ™ï¼‰
 * @Copyright 2021 Â© kuwo.cn
 * @date 2021/5/27 14:40
 * @Version: 1.0
 */
@Component
public class MyRequestOriginParser implements RequestOriginParser {

    @Override
    public String parseOrigin(HttpServletRequest request) {
        //ä»è¯·æ±‚å‚æ•°ä¸­è·å–å‚æ•°
        String origin = request.getParameter("origin");
        //å¦‚æœè¯·æ±‚å‚æ•°ä¸­æ²¡æœ‰ä»è¯·æ±‚headerä¸­è·å–
        if(StringUtils.isBlank(origin)){
            origin = request.getHeader("origin");
        }

        //è¿˜å¯ä»¥åœ¨è¿™é‡Œé™åˆ¶ä¸€ä¸‹  æ²¡æœ‰åº”ç”¨æ ‡è¯†ç›´æ¥æ‹¦æˆªæˆ–æŠ›å‡ºå¼‚å¸¸
        /*if(StringUtils.isBlank(origin)){
            throw new IllegalArgumentException("originå‚æ•°ä¸ºæŒ‡å®š");
        }*/

        return origin;
    }
}
```



**æµ‹è¯•**

è¿”å›çš„ç»“æœæ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„é™æµå“åº”ç»“æœï¼Œä¸æ˜¯sentinelé»˜è®¤çš„ã€‚

![image-20210609183110724](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609183110724.png)

## äº”. Sentinel Dashboardæ§åˆ¶å°é€šä¿¡åŸç†

![image-20210609183130952](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609183130952.png)

å½“å¾®æœåŠ¡å¯åŠ¨ä¹‹åé€šè¿‡``sentinel-transport-simple-http``è¿™ä¸ªä¾èµ–å°†è¯¥æœåŠ¡çš„ä¸€äº›ç«¯ç‚¹ä¿¡æ¯æ³¨å†Œåˆ°``sentinel dashboard``ä¸­

ç„¶åè¯¥æœåŠ¡ç”±äºå¼•ç”¨äº†sentinelçš„ä¾èµ–ï¼Œæ³¨å†Œåä¼šåœ¨è¯¥æœåŠ¡ä¸­é»˜è®¤å¯åŠ¨ä¸€ä¸ª8719ç«¯å£ï¼Œä½†æ˜¯å¦‚æœè¯¥æœåŠ¡æ‰€åœ¨æœºå™¨å·²ç»å­˜åœ¨8719ç«¯å£åˆ™ä¼šé€’å¢åŠ 1ï¼Œç›´è‡³åˆ°å¯ç”¨ä¸ºæ­¢

é‚£ä¹ˆå¾®æœåŠ¡é€šè¿‡8719ç«¯å£ä¼šå‘sentinelæš´éœ²å¾ˆå¤šhttpæ¥å£ï¼ˆå¯é€šè¿‡ æœåŠ¡IP:8719/api è¿™ä¸ªåœ°å€æŸ¥çœ‹å¾®æœåŠ¡é€šè¿‡8719å‘sentinelæš´éœ²äº†å“ªäº›æ¥å£ï¼‰

![image-20210609183156516](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609183156516.png)

ç„¶åsentinel dashboardå°±ä¼šè°ƒç”¨å¾®æœåŠ¡æš´éœ²çš„è¿™äº›æ¥å£å»è·å–æœåŠ¡ä¿¡æ¯ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥çœ‹æœåŠ¡æš´éœ²çš„ç¬¬ä¸€ä¸ªæ¥å£å¦‚ä¸‹

![image-20210609183207681](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609183207681.png)

è¯¥æ¥å£å¯ä»¥é€šè¿‡èµ„æºåç§°è·å–èµ„æºä¿¡æ¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥è¯•ä¸€ä¸‹æˆ‘ä»¬æœåŠ¡ä¸­çš„ä¸€ä¸ªæ¥å£èµ„æº

![image-20210609183223537](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609183223537.png)

é‚£ä¹ˆsentinel dashboardå°±æ˜¯è¿™æ ·ä¸æˆ‘ä»¬çš„æœåŠ¡è¿›è¡Œé€šè®¯è·å–åˆ°å„ç§ä¿¡æ¯çš„

**åœ¨sentinelä¸­è®¾ç½®çš„é™æµè§„åˆ™æ˜¯å¦‚ä½•å‘ŠçŸ¥å¾®æœåŠ¡çš„ï¼Ÿ**

å½“ç„¶ä¹Ÿæ˜¯é€šè¿‡å¾®æœåŠ¡æš´éœ²çš„æ¥å£è¿›è¡Œå‘ŠçŸ¥çš„ï¼Œä¹Ÿå°±æ˜¯å¦‚ä¸‹ setRulesæ¥å£ï¼Œå°†åœ¨dashboardè®¾ç½®çš„è§„åˆ™å‘ŠçŸ¥ç»™å¾®æœåŠ¡ï¼Œç„¶åå¾®æœåŠ¡ä¼šå°†è¯¥è§„åˆ™ç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚

ç„¶ådashboardé€šè¿‡ /getRulesæ¥å£å†å»å¾®æœåŠ¡ä¸­è·å–è¯¥æœåŠ¡çš„ä¸€äº›é™çº§é™æµè§„åˆ™ï¼Œè¿™ä¹Ÿè¯´æ˜äº†ä¸ºä»€ä¹ˆæˆ‘ä»¬é€šå¸¸é‡å¯æœåŠ¡åï¼Œè¯¥æœåŠ¡ä¹‹å‰è®¾ç½®çš„è§„åˆ™å°±ä¼šä¸è§ã€‚

ï¼ˆé€šå¸¸æˆ‘ä»¬éƒ½ä¼šå°†sentinelè®¾ç½®çš„è§„åˆ™ä¿¡æ¯æŒä¹…åŒ–åˆ°Nacosï¼‰

![image-20210609183232354](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609183232354.png)

## å…­. Sentinelä¸¤ç§ä¿æŠ¤åº”ç”¨çš„æ–¹å¼

### 6.1 ï¼ˆé»˜è®¤ï¼‰æ‹¦æˆªæ‰€æœ‰controllerçš„è¯·æ±‚urlè·¯å¾„

Sentinelä¸ºspringbootç¨‹åºæä¾›äº†ä¸€ä¸ªstarterä¾èµ–ï¼Œç”±äºsentinel starterä¾èµ–é»˜è®¤æƒ…å†µä¸‹å°±ä¼šä¸ºæ‰€æœ‰çš„HTTPæ¥å£æä¾›é™æµåŸ‹ç‚¹ï¼Œæ‰€ä»¥åœ¨springboot ä¸­çš„Controlleréƒ½å¯ä»¥å—åˆ°Sentinelçš„ä¿æŠ¤ï¼›å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨Sentinel Dashboardä¸­é…ç½®é™æµçš„ä¿æŠ¤è§„åˆ™ã€‚

**å®ç°åŸç†ï¼š**

ä»–çš„å®ç°åŸç†å°±æ˜¯ï¼Œåº•å±‚é€šè¿‡``com.alibaba.csp.sentinel.adapter.spring.webmvc.AbstractSentinelInterceptor``è¿™ä¸ªæ‹¦æˆªå™¨å¯¹æ‰€æœ‰çš„Controlleræ¥å£è¿›è¡Œäº†æ‹¦æˆª

![image-20210609183319933](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609183319933.png)

å†æ‹¦æˆªæ–¹æ³• preHandle ä¸­ä¸»è¦é€šè¿‡å¦‚ä¸‹æ–¹æ³•è¿›è¡Œåˆ¤æ–­è§¦å‘äº†å“ªç§è¡Œä¸ºï¼ˆæµé‡ã€å‚æ•°çƒ­ç‚¹ã€é™çº§ã€æƒé™ã€ç³»ç»Ÿè§„åˆ™ï¼‰

![image-20210609183350231](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609183350231.png)

é‚£åˆ°åº•æ˜¯å¦‚ä½•è¿›è¡Œåˆ¤æ–­çš„å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥è¿›å…¥entryæ–¹æ³•çœ‹ä¸€ä¸‹ï¼Œ

æˆ‘ä»¬å¯ä»¥å‘ç°è¯¥æ–¹æ³•ä¼šæŠ›å‡º ``BlockException`` å¼‚å¸¸ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•ä¹Ÿå°±æ˜¯é€šè¿‡æ‹¦æˆªåˆ°ä½ è¿™ä¸ªcontrolleræ¥å£å¾—åˆ°æ¥å£èµ„æºåç§°ï¼Œç„¶åæ ¹æ®sentinelé…ç½®çš„è§„åˆ™è¿›è¡Œåˆ¤æ–­ä½ è§¦å‘äº†å“ªä¸€é¡¹ï¼ˆæµé‡ã€å‚æ•°çƒ­ç‚¹ã€é™çº§ã€æƒé™ã€ç³»ç»Ÿè§„åˆ™ï¼‰è§„åˆ™ï¼Œç„¶åæŠ¥è¯¥é¡¹é™æµè§„åˆ™æ‰€å¯¹åº”çš„å¼‚å¸¸

![image-20210609183405453](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609183405453.png)

æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹ BlockExecption çš„å‡ ç§å­å¼‚å¸¸ï¼Œåˆ†åˆ«å¯¹åº”äº† æµé‡ã€å‚æ•°çƒ­ç‚¹ã€é™çº§ã€æƒé™ã€ç³»ç»Ÿè§„åˆ™

![image-20210609183419554](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609183419554.png)

å†æ ¹æ®ä¸åŒçš„é™çº§è§„åˆ™åšä¸åŒçš„é™çº§å¤„ç†ã€‚

**å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®å…³é—­å®ƒå¯¹æ‰€æœ‰Controlleræ¥å£æ‹¦æˆªä¿æŠ¤**

\#å…³é—­sentinelå¯¹controllerçš„urlçš„ä¿æŠ¤    falseå…³é—­ä¿æŠ¤  é»˜è®¤trueå¼€å¯ä¿æŠ¤ spring.cloud.sentinel.filter.enabled=false

### 6.2 é€šè¿‡æ³¨è§£ä¿æŠ¤åº”ç”¨**

åœ¨å‰é¢æˆ‘ä»¬æœ‰è‡ªå®šä¹‰é™æµå“åº”ç»“æœï¼Œä½†æ˜¯ä»–çš„å½±å“åº¦æ˜¯å…¨å±€çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦ç»™æŸä¸ªæ¥å£è®¾ç½®äº†é™æµè§„åˆ™ï¼Œå½“é™æµä¹‹åéƒ½ä¼šç»Ÿä¸€çš„èµ°è¿™ä¸ªè‡ªå®šä¹‰é™æµå“åº”ã€‚

åŒç†ï¼Œå¦‚æœä¸è®¾ç½®è‡ªå®šä¹‰é™æµå“åº”ï¼Œå°±ä¼šèµ°é»˜è®¤çš„å“åº”ç»“æœã€‚

é‚£ä¹ˆå¯¹äºæˆ‘ä»¬æœ‰ç‰¹æ®Šéœ€æ±‚çš„æ¥å£ï¼Œå¯¹äºé™æµä¹‹åï¼Œæœ‰ä¸ä¼—ä¸åŒçš„å“åº”çš„è¯ï¼Œæˆ‘ä»¬å°±éœ€è¦é€šè¿‡æ³¨è§£çš„æ–¹å¼å•ç‹¬ä¸ºæ­¤æ¥å£å£°æ˜ fallback å¼‚å¸¸å¤„ç†é€»è¾‘

![image-20210609183435767](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609183435767.png)

**fallbackClass é™æµå¤„ç†ç±»**

![image-20210609183450123](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609183450123.png)

**Sentinelé™æµè§„åˆ™é…ç½®**

å¿…é¡»è¦ä¸º getData7 è¿™ä¸ªä¸å¸¦ æ–œæ çš„èµ„æºè¿›è¡Œæµæ§è®¾ç½®ï¼Œå¦‚æœå¯¹ /getData7èµ„æºè¿›è¡Œæµæ§ï¼Œèµ°çš„æ˜¯å…¨å±€ç»Ÿä¸€é»˜è®¤çš„é™æµå¤„ç†ã€‚åªæœ‰å¯¹getData7èµ„æºè¿›è¡Œæµæ§é…ç½®ï¼Œæ‰ä¼šèµ°æˆ‘ä»¬åˆšåˆšè‡ªå®šä¹‰çš„é™æµå¤„ç†ç±»ä¸­çš„å¤„ç†æ–¹æ³•

![image-20210609183519023](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609183519023.png)

![image-20210609183532424](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609183532424.png)

**æµ‹è¯•**

æœ€ç»ˆæ˜¯è¿›å…¥æˆ‘ä»¬å•ç‹¬ä¸ºè¯¥æ¥å£é…ç½®çš„é™æµå¤„ç†ç±»

![image-20210609183542692](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609183542692.png)

**è®¿é—®å…¶ä»–æ¥å£èµ„æºæµ‹è¯•**

è¿›å…¥çš„æ˜¯è‡ªå®šä¹‰çš„å…¨å±€é™æµå¤„ç†ç±»ï¼ˆå°±ç®—æ²¡æœ‰è‡ªå®šä¹‰é™æµå¤„ç†ç±»ï¼Œä¹Ÿä¼šè¿›å…¥å…¨å±€é»˜è®¤çš„å¤„ç†ç±»ï¼‰

![image-20210609183553003](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609183553003.png)

**@SentinelResourceæ³¨è§£ä¸­çš„å‚æ•°è¯¦è§£ï¼š**

| **å±æ€§**           | **ä½œç”¨**                                                     | **æ˜¯å¦å¿…é¡»** |
| ------------------ | ------------------------------------------------------------ | ------------ |
| value              | èµ„æºåç§°                                                     | æ˜¯           |
| entryType          | entryç±»å‹ï¼Œæ ‡è®°æµé‡çš„æ–¹å‘ï¼Œå–å€¼IN/OUTï¼Œé»˜è®¤æ˜¯OUT             | å¦           |
| blockHandler       | å¤„ç†BlockExceptionçš„å‡½æ•°åç§°ã€‚å‡½æ•°è¦æ±‚ï¼š1. å¿…é¡»æ˜¯ public2.è¿”å›ç±»å‹ä¸åŸæ–¹æ³•ä¸€è‡´3. å‚æ•°ç±»å‹éœ€è¦å’ŒåŸæ–¹æ³•ç›¸åŒ¹é…ï¼Œå¹¶åœ¨æœ€ååŠ  BlockException ç±»å‹çš„å‚æ•°ã€‚4. é»˜è®¤éœ€å’ŒåŸæ–¹æ³•åœ¨åŒä¸€ä¸ªç±»ä¸­ã€‚è‹¥å¸Œæœ›ä½¿ç”¨å…¶ä»–ç±»çš„å‡½æ•°ï¼Œå¯é…ç½® blockHandlerClass ï¼Œå¹¶æŒ‡å®šblockHandlerClassé‡Œé¢çš„æ–¹æ³•ã€‚ | å¦           |
| blockHandlerClass  | å­˜æ”¾blockHandlerçš„ç±»ã€‚å¯¹åº”çš„å¤„ç†å‡½æ•°å¿…é¡»staticä¿®é¥°ï¼Œå¦åˆ™æ— æ³•è§£æï¼Œå…¶ä»–è¦æ±‚ï¼šåŒblockHandlerã€‚ | å¦           |
| fallback           | ç”¨äºåœ¨æŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™æä¾›fallbackå¤„ç†é€»è¾‘ã€‚fallbackå‡½æ•°å¯ä»¥é’ˆå¯¹æ‰€æœ‰ç±»å‹çš„å¼‚å¸¸ï¼ˆé™¤äº† exceptionsToIgnore é‡Œé¢æ’é™¤æ‰çš„å¼‚å¸¸ç±»å‹ï¼‰è¿›è¡Œå¤„ç†ã€‚å‡½æ•°è¦æ±‚ï¼š1. è¿”å›ç±»å‹ä¸åŸæ–¹æ³•ä¸€è‡´2. å‚æ•°ç±»å‹éœ€è¦å’ŒåŸæ–¹æ³•ç›¸åŒ¹é…ï¼ŒSentinel 1.6å¼€å§‹ï¼Œä¹Ÿå¯åœ¨æ–¹æ³•æœ€ååŠ  Throwable ç±»å‹çš„å‚æ•°ã€‚3.é»˜è®¤éœ€å’ŒåŸæ–¹æ³•åœ¨åŒä¸€ä¸ªç±»ä¸­ã€‚è‹¥å¸Œæœ›ä½¿ç”¨å…¶ä»–ç±»çš„å‡½æ•°ï¼Œå¯é…ç½® fallbackClass ï¼Œå¹¶æŒ‡å®šfallbackClassé‡Œé¢çš„æ–¹æ³•ã€‚ | å¦           |
| fallbackClass      | å­˜æ”¾fallbackçš„ç±»ã€‚å¯¹åº”çš„å¤„ç†å‡½æ•°å¿…é¡»staticä¿®é¥°ï¼Œå¦åˆ™æ— æ³•è§£æï¼Œå…¶ä»–è¦æ±‚ï¼šåŒfallbackã€‚ | å¦           |
| defaultFallback    | ç”¨äºé€šç”¨çš„ fallback é€»è¾‘ã€‚é»˜è®¤fallbackå‡½æ•°å¯ä»¥é’ˆå¯¹æ‰€æœ‰ç±»å‹çš„å¼‚å¸¸ï¼ˆé™¤äº† exceptionsToIgnore é‡Œé¢æ’é™¤æ‰çš„å¼‚å¸¸ç±»å‹ï¼‰è¿›è¡Œå¤„ç†ã€‚è‹¥åŒæ—¶é…ç½®äº† fallback å’Œ defaultFallbackï¼Œä»¥fallbackä¸ºå‡†ã€‚å‡½æ•°è¦æ±‚ï¼š1. è¿”å›ç±»å‹ä¸åŸæ–¹æ³•ä¸€è‡´2. æ–¹æ³•å‚æ•°åˆ—è¡¨ä¸ºç©ºï¼Œæˆ–è€…æœ‰ä¸€ä¸ª Throwable ç±»å‹çš„å‚æ•°ã€‚3. é»˜è®¤éœ€è¦å’ŒåŸæ–¹æ³•åœ¨åŒä¸€ä¸ªç±»ä¸­ã€‚è‹¥å¸Œæœ›ä½¿ç”¨å…¶ä»–ç±»çš„å‡½æ•°ï¼Œå¯é…ç½® fallbackClass ï¼Œå¹¶æŒ‡å®š fallbackClass é‡Œé¢çš„æ–¹æ³•ã€‚ | å¦           |
| exceptionsToIgnore | æŒ‡å®šæ’é™¤æ‰å“ªäº›å¼‚å¸¸ã€‚æ’é™¤çš„å¼‚å¸¸ä¸ä¼šè®¡å…¥å¼‚å¸¸ç»Ÿè®¡ï¼Œä¹Ÿä¸ä¼šè¿›å…¥fallbacké€»è¾‘ï¼Œè€Œæ˜¯åŸæ ·æŠ›å‡ºã€‚ | å¦           |
| exceptionsToTrace  | éœ€è¦traceçš„å¼‚å¸¸                                              | Throwable    |

## ä¸ƒ. Sentinelæ•´åˆå¾®æœåŠ¡è°ƒç”¨

### 7.1 Sentinelæ•´åˆRestTemplate

**åœ¨application.yamlä¸­åŠ å…¥å¦‚ä¸‹é…ç½®ï¼ˆé»˜è®¤å¼€å¯ï¼Œå¯ä»¥ä¸é…ç½®ï¼‰**

```yaml
# å¼€å¯sentinelå¯¹restemplateçš„æ”¯æŒ  trueå¼€å¯ï¼ˆé»˜è®¤ï¼‰  falseå…³é—­
resttemplate:
  sentinel:
    enabled: true
```

**åœ¨ä¸»å¯åŠ¨ç±»å®ä¾‹åŒ–RestTemplateæ–¹æ³•ä¸ŠåŠ æ³¨è§£**

```java
@Bean
//å¦‚æœä¸åŠ é™æµå¤„ç†ç±»å°±èµ°é»˜è®¤çš„
@SentinelRestTemplate(//blockHandler = "block", blockHandlerClass = RestTemplateBlockHandler.class,//é™æµç”¨blockHandler
        fallback = "fallback", fallbackClass = RestTemplateBlockHandler.class)//é™çº§ç”¨fallback
@LoadBalanced//è´Ÿè½½å‡è¡¡çš„å»è°ƒç”¨
public RestTemplate restTemplate() {
    return new RestTemplate();
}
```

``æ³¨è§£ä¸­å¦‚æœä¸é…ç½® é™æµ/é™çº§ å¤„ç†ç±»å°±ä¼šèµ°é»˜è®¤çš„``

``å¹¶ä¸” å¦‚æœè§¦å‘äº†sentinelé™æµè§„åˆ™ä¼šèµ°blockHandlerå‚æ•°é…ç½®çš„é™æµå¤„ç†ç±»``

``å¦‚æœè§¦å‘äº†sentinelé™çº§è§„åˆ™ä¼šèµ°fallbackå‚æ•°é…ç½®çš„é™çº§å¤„ç†ç±»``

``å¹¶ä¸”ä¸èƒ½åŒæ—¶ä½¿ç”¨ï¼Œä¼šå¯åŠ¨å¤±è´¥``

![image-20210609183651197](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609183651197.png)

**é™æµå’Œé™çº§å¤„ç†ç±»**

```java
import com.alibaba.cloud.sentinel.rest.SentinelClientHttpResponse;
import com.alibaba.csp.sentinel.slots.block.BlockException;
import org.springframework.http.HttpRequest;
import org.springframework.http.client.ClientHttpRequestExecution;

/**
 * @author zhengtai.li
 * @ClassName RestTemplateBlockHandler
 * @Description restTemplateé™çº§å’Œé™çº§å¤„ç†ç±»
 * @Copyright 2021 Â© kuwo.cn
 * @date 2021/5/29 15:42
 * @Version: 1.0
 */
public class RestTemplateBlockHandler {

    /**
     * é™æµå¤„ç†æ–¹æ³•
     * resttemplateé™æµåçš„å¤„ç†æ–¹æ³•
     * è¯¥æ–¹æ³•çš„è¿”å›å€¼ä¸€å®šæ˜¯SentinelClientHttpResponse
     *
     * @return
     */
    public static SentinelClientHttpResponse blockA(HttpRequest request,
                                                       byte[] body,
                                                       ClientHttpRequestExecution execution,
                                                       BlockException ex) {

        System.err.println("fallback: " + ex.getClass().getCanonicalName());
        return new SentinelClientHttpResponse("é™æµäº†æˆ‘çš„åŒ—é¼»~~~~~~");
    }

    /**
     * é™çº§å¤„ç†æ–¹æ³•
     * @return
     */
    public static SentinelClientHttpResponse fallback(HttpRequest request,
                                                       byte[] body,
                                                       ClientHttpRequestExecution execution,
                                                       BlockException ex) {

        System.err.println("fallback: " + ex.getClass().getCanonicalName());
        return new SentinelClientHttpResponse("é™çº§äº†æˆ‘çš„åŒ—é¼»~~~~~~");
    }
}
```

![image-20210609183714420](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609183714420.png)

**æµ‹è¯•æ¥å£**

![image-20210609183724789](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609183724789.png)

**Sentinelé…ç½®**

![image-20210609183736778](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609183736778.png)

åªæµ‹è¯•é’ˆå¯¹nacos-provideræä¾›è€…çš„getDataèµ„æºè¿›è¡Œæµæ§

![image-20210609183859636](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609183859636.png)

**è®¿é—®æµ‹è¯•**

![image-20210609183813438](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609183813438.png)



### 7.2 Sentinelæ•´åˆFeign

**åœ¨application.yamlä¸­åŠ å…¥å¦‚ä¸‹é…ç½®ï¼ˆé»˜è®¤å…³é—­ï¼‰**

```yaml
#trueå¼€å¯sentinelå¯¹feignçš„æ”¯æŒï¼Œfalseåˆ™å…³é—­ï¼ˆé»˜è®¤ï¼‰
feign.sentinel.enabled=true
```



#### 7.2.1 æ–¹å¼ä¸€ï¼šfallbacké™æµé™çº§å¤„ç†ç±»

**Feignè°ƒç”¨çš„Service**

name:è¯¥æ¥å£å¯¹åº”æä¾›è€…æ³¨å†Œåˆ°Nacosçš„æœåŠ¡å‘½

fallbackï¼šè¯¥Serviceä¸­çš„æ¥å£å¦‚æœå‘ç”Ÿé™æµé™çº§ç†”æ–­çš„å¤„ç†ç±»

configurationï¼šfeigné…ç½®ç±»ï¼Œä¸»è¦ç”¨æˆ·å®ä¾‹åŒ–fallbackå¤„ç†ç±»

![image-20210609183938630](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609183938630.png)

**fallbacké™æµé™çº§å¤„ç†ç±»**

è¯¥getData2æ–¹æ³•å°±æ˜¯é’ˆå¯¹äºFeignè°ƒç”¨Serviceä¸‹çš„å“ªä¸ªæ¥å£å»ä¸“é—¨åšé™æµé™çº§å¤„ç†

![image-20210609183954846](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609183954846.png)

**Feignçš„fallbackå®ä¾‹åŒ–é…ç½®ç±»**

ä¸»è¦å°±æ˜¯ç”¨äºå®ä¾‹åŒ–fallbackå¤„ç†ç±»çš„

![image-20210609184011197](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609184011197.png)

**Feignè°ƒç”¨æµ‹è¯•æ¥å£**

![image-20210609184036578](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609184036578.png)

**Sentinelé…ç½®**

![image-20210609184054471](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609184054471.png)

![image-20210609184107288](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609184107288.png)

**è®¿é—®æµ‹è¯•**

![image-20210609184119232](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609184119232.png)

#### 7.2.2 æ–¹å¼äºŒï¼šfallbackFactoryå·¥å‚

**Feignè°ƒç”¨çš„Service**

name:è¯¥æ¥å£å¯¹åº”æä¾›è€…æ³¨å†Œåˆ°Nacosçš„æœåŠ¡å‘½

fallbackFactoryï¼šè¯¥Serviceä¸­çš„æ¥å£å¦‚æœå‘ç”Ÿé™æµé™çº§ç†”æ–­çš„å¤„ç†å·¥å‚ï¼Œé‡Œé¢ä¼šåŒ…å«è¯¥Serviceä¸‹æ‰€æœ‰æ¥å£çš„é™æµæ–¹æ³•

configurationï¼šfeigné…ç½®ç±»ï¼Œä¸»è¦ç”¨æˆ·å®ä¾‹åŒ–fallbackFactory

![image-20210609184138436](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609184138436.png)

**fallbackFactory**

![image-20210609184153451](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609184153451.png)

**Feignçš„fallbackFactoryå®ä¾‹åŒ–é…ç½®ç±»**

![image-20210609184208599](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609184208599.png)

**Feignè°ƒç”¨æµ‹è¯•æ¥å£**

![image-20210609184220112](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609184220112.png)

**Sentinelé…ç½®**

![image-20210609184233282](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609184233282.png)

![image-20210609184245846](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609184245846.png)

**è®¿é—®æµ‹è¯•**

![image-20210609184254579](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609184254579.png)

## å…«. SentinelæŒä¹…åŒ–

**é»˜è®¤ï¼š**é»˜è®¤æƒ…å†µä¸‹æˆ‘ä»¬åœ¨dashboardé…ç½®çš„è§„åˆ™ä¼šé€šè¿‡å¾®æœåŠ¡æš´éœ²sentinelæ¥å£ï¼Œæ¨é€ç»™å¾®æœåŠ¡ï¼Œç„¶åå¾®æœåŠ¡å°†è§„åˆ™ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œdashboardæ˜¯ä¸æä¾›å­˜å‚¨çš„ã€‚

æ‰€ä»¥æˆ‘ä»¬é‡å¯æœåŠ¡ä¹‹åï¼Œè§„åˆ™å°±ä¼šä¸¢å¤±ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿›è¡ŒæŒä¹…åŒ–

**æ‰€æœ‰æŒä¹…åŒ–æ“ä½œéƒ½æ˜¯åœ¨å¾®æœåŠ¡ç«¯è¿›è¡Œé…ç½®çš„ï¼Œä¸æ˜¯åœ¨sentinel dashboardé…ç½®çš„**

### 8.1 pullæ¨¡å¼æŒä¹…åŒ–åˆ°æœ¬åœ°æ–‡ä»¶

![image-20210609184314903](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609184314903.png)

**åŸç†**

dashboardæ¨é€çš„è§„åˆ™ä¿¡æ¯ä¼šç”±å¾®æœåŠ¡ä¸­çš„sentinelå®¢æˆ·ç«¯ä¿å­˜åˆ°æœåŠ¡å†…å­˜ä¸­ï¼Œç„¶åå†™å…¥æœ¬åœ°æ–‡ä»¶è¿›è¡ŒæŒä¹…åŒ–ã€‚å½“æœåŠ¡é‡å¯åï¼Œå†…å­˜ä¸­çš„è§„åˆ™ä¼šä¸¢å¤±ï¼Œä½†æ˜¯ä»–ä¼šå»æœ¬åœ°æ–‡ä»¶ä¸­è¯»å–ï¼Œç„¶åé‡æ–°åŠ è½½åˆ°å†…å­˜ä¸­ã€‚

**åœ¨é¡¹ç›®ä¸­ç¼–å†™è§„åˆ™æŒä¹…åŒ–ç±»**

![image-20210609184327317](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609184327317.png)

```java
import com.alibaba.csp.sentinel.command.handler.ModifyParamFlowRulesCommandHandler;
import com.alibaba.csp.sentinel.datasource.*;
import com.alibaba.csp.sentinel.init.InitFunc;
import com.alibaba.csp.sentinel.slots.block.authority.AuthorityRule;
import com.alibaba.csp.sentinel.slots.block.authority.AuthorityRuleManager;
import com.alibaba.csp.sentinel.slots.block.degrade.DegradeRule;
import com.alibaba.csp.sentinel.slots.block.degrade.DegradeRuleManager;
import com.alibaba.csp.sentinel.slots.block.flow.FlowRule;
import com.alibaba.csp.sentinel.slots.block.flow.FlowRuleManager;
import com.alibaba.csp.sentinel.slots.block.flow.param.ParamFlowRule;
import com.alibaba.csp.sentinel.slots.block.flow.param.ParamFlowRuleManager;
import com.alibaba.csp.sentinel.slots.system.SystemRule;
import com.alibaba.csp.sentinel.slots.system.SystemRuleManager;
import com.alibaba.csp.sentinel.transport.util.WritableDataSourceRegistry;
import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.TypeReference;

import java.io.File;
import java.io.IOException;
import java.util.List;

/**
 * æœ¬åœ°æ–‡ä»¶æŒä¹…åŒ–æ–¹å¼çš„-è§„åˆ™æŒä¹…åŒ–é…ç½®ç±»
 */
public class FileDataSourceInit implements InitFunc {

    @Override
    public void init() throws Exception {
        //æŒä¹…åŒ–æ–‡ä»¶ä¿å­˜è·¯å¾„ï¼Œå¯è‡ªè¡Œå®šä¹‰ï¼Œwindowså’Œlinuxè‚¯å®šä¸ä¸€æ ·
        String ruleDir = System.getProperty("user.home") + "/sentinel/rules";

        //å„ç§è§„åˆ™æ–‡ä»¶
        String flowRulePath = ruleDir + "/flow-rule.json";
        String degradeRulePath = ruleDir + "/degrade-rule.json";
        String paramFlowRulePath = ruleDir + "/param-flow-rule.json";
        String systemRulePath = ruleDir + "/system-rule.json";
        String authorityRulePath = ruleDir + "/authority-rule.json";

        //åˆ›å»ºä¿å­˜æŒä¹…åŒ–è§„åˆ™æ–‡ä»¶ç›®å½•
        this.mkdirIfNotExits(ruleDir);

        //åˆ›å»ºæŒä¹…åŒ–è§„åˆ™æ–‡ä»¶è·¯å¾„
        this.createFileIfNotExits(flowRulePath);
        this.createFileIfNotExits(degradeRulePath);
        this.createFileIfNotExits(paramFlowRulePath);
        this.createFileIfNotExits(systemRulePath);
        this.createFileIfNotExits(authorityRulePath);

        // æµæ§è§„åˆ™ï¼šå¯è¯»æ•°æ®æº
        ReadableDataSource<String, List<FlowRule>> flowRuleRDS = new FileRefreshableDataSource<>(
                flowRulePath,
                flowRuleListParser
        );
        // å°†å¯è¯»æ•°æ®æºæ³¨å†Œè‡³FlowRuleManager
        // è¿™æ ·å½“è§„åˆ™æ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°±ä¼šæ›´æ–°è§„åˆ™åˆ°å†…å­˜
        FlowRuleManager.register2Property(flowRuleRDS.getProperty());
        // æµæ§è§„åˆ™ï¼šå¯å†™æ•°æ®æº
        WritableDataSource<List<FlowRule>> flowRuleWDS = new FileWritableDataSource<>(
                flowRulePath,
                this::encodeJson
        );
        // å°†å¯å†™æ•°æ®æºæ³¨å†Œè‡³transportæ¨¡å—çš„WritableDataSourceRegistryä¸­
        // è¿™æ ·æ”¶åˆ°æ§åˆ¶å°æ¨é€çš„è§„åˆ™æ—¶ï¼ŒSentinelä¼šå…ˆæ›´æ–°åˆ°å†…å­˜ï¼Œç„¶åå°†è§„åˆ™å†™å…¥åˆ°æ–‡ä»¶ä¸­
        WritableDataSourceRegistry.registerFlowDataSource(flowRuleWDS);


        // é™çº§è§„åˆ™ï¼šå¯è¯»æ•°æ®æº
        ReadableDataSource<String, List<DegradeRule>> degradeRuleRDS = new FileRefreshableDataSource<>(
                degradeRulePath,
                degradeRuleListParser
        );
        DegradeRuleManager.register2Property(degradeRuleRDS.getProperty());
        // é™çº§è§„åˆ™ï¼šå¯å†™æ•°æ®æº
        WritableDataSource<List<DegradeRule>> degradeRuleWDS = new FileWritableDataSource<>(
                degradeRulePath,
                this::encodeJson
        );
        WritableDataSourceRegistry.registerDegradeDataSource(degradeRuleWDS);


        // çƒ­ç‚¹å‚æ•°è§„åˆ™ï¼šå¯è¯»æ•°æ®æº
        ReadableDataSource<String, List<ParamFlowRule>> paramFlowRuleRDS = new FileRefreshableDataSource<>(
                paramFlowRulePath,
                paramFlowRuleListParser
        );
        ParamFlowRuleManager.register2Property(paramFlowRuleRDS.getProperty());
        // çƒ­ç‚¹å‚æ•°è§„åˆ™ï¼šå¯å†™æ•°æ®æº
        WritableDataSource<List<ParamFlowRule>> paramFlowRuleWDS = new FileWritableDataSource<>(
                paramFlowRulePath,
                this::encodeJson
        );
        ModifyParamFlowRulesCommandHandler.setWritableDataSource(paramFlowRuleWDS);


        // ç³»ç»Ÿè§„åˆ™ï¼šå¯è¯»æ•°æ®æº
        ReadableDataSource<String, List<SystemRule>> systemRuleRDS = new FileRefreshableDataSource<>(
                systemRulePath,
                systemRuleListParser
        );
        SystemRuleManager.register2Property(systemRuleRDS.getProperty());
        // ç³»ç»Ÿè§„åˆ™ï¼šå¯å†™æ•°æ®æº
        WritableDataSource<List<SystemRule>> systemRuleWDS = new FileWritableDataSource<>(
                systemRulePath,
                this::encodeJson
        );
        WritableDataSourceRegistry.registerSystemDataSource(systemRuleWDS);


        // æˆæƒè§„åˆ™ï¼šå¯è¯»æ•°æ®æº
        ReadableDataSource<String, List<AuthorityRule>> authorityRuleRDS = new FileRefreshableDataSource<>(
                authorityRulePath,
                authorityRuleListParser
        );
        AuthorityRuleManager.register2Property(authorityRuleRDS.getProperty());
        // æˆæƒè§„åˆ™ï¼šå¯å†™æ•°æ®æº
        WritableDataSource<List<AuthorityRule>> authorityRuleWDS = new FileWritableDataSource<>(
                authorityRulePath,
                this::encodeJson
        );
        WritableDataSourceRegistry.registerAuthorityDataSource(authorityRuleWDS);
    }


    private Converter<String, List<FlowRule>> flowRuleListParser = source -> JSON.parseObject(
            source,
            new TypeReference<List<FlowRule>>() {
            }
    );

    private Converter<String, List<DegradeRule>> degradeRuleListParser = source -> JSON.parseObject(
            source,
            new TypeReference<List<DegradeRule>>() {
            }
    );

    private Converter<String, List<SystemRule>> systemRuleListParser = source -> JSON.parseObject(
            source,
            new TypeReference<List<SystemRule>>() {
            }
    );

    private Converter<String, List<AuthorityRule>> authorityRuleListParser = source -> JSON.parseObject(
            source,
            new TypeReference<List<AuthorityRule>>() {
            }
    );

    private Converter<String, List<ParamFlowRule>> paramFlowRuleListParser = source -> JSON.parseObject(
            source,
            new TypeReference<List<ParamFlowRule>>() {
            }
    );

    private void mkdirIfNotExits(String filePath) throws IOException {
        File file = new File(filePath);
        if (!file.exists()) {
            file.mkdirs();
        }
    }

    private void createFileIfNotExits(String filePath) throws IOException {
        File file = new File(filePath);
        if (!file.exists()) {
            file.createNewFile();
        }
    }

    private <T> String encodeJson(T t) {
        return JSON.toJSONString(t);
    }
}
```



**é…ç½®SPI**

``resources\META-INF\services\com.alibaba.csp.sentinel.init.InitFunc``

æ–‡ä»¶åç§°æ˜¯å›ºå®šçš„ï¼Œå†…å®¹å°±æ˜¯æŒä¹…åŒ–é…ç½®ç±»çš„è·¯å¾„

![image-20210609184352646](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609184352646.png)

**æµ‹è¯•**

**ç¬¬ä¸€æ­¥ï¼šé‡å¯æœåŠ¡**

**ç¬¬äºŒæ­¥ï¼šåˆ›å»ºsentinelé™æµè§„åˆ™**

![image-20210609184409038](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609184409038.png)

æ­¤æ—¶è¯¥è§„åˆ™ä¼šè¢«dashboardæ¨é€ç»™æœåŠ¡ï¼Œç”±æœåŠ¡ç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œå¹¶å†™å…¥åˆ°æœ¬åœ°çš„æŒä¹…åŒ–æ–‡ä»¶

**ç¬¬ä¸‰æ­¥ï¼šæŸ¥çœ‹è§„åˆ™æŒä¹…åŒ–æ–‡ä»¶**

æˆ‘è¿™æ˜¯åœ¨windowsç”µè„‘ä¸Šæµ‹è¯•çš„ï¼Œlinuxå…¶å®ä¹Ÿä¸€æ ·å»æ‰¾ç›®å½•å°±å¯ä»¥äº†

å¦‚æœä½ æ˜¯ç”¨dockeréƒ¨ç½²é¡¹ç›®ï¼Œä¸€å®šè¦å°†å®¹å™¨ä¸­çš„æŒä¹…åŒ–ç›®å½•æŒ‚è½½åˆ°å¤–é¢ï¼Œå¦åˆ™é‡å¯æœåŠ¡ä¼šç”Ÿæˆæ–°çš„å®¹å™¨ï¼Œé‚£ä¹ˆè§„åˆ™è¿˜æ˜¯ä¼šä¸¢å¤±

![image-20210609184425479](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609184425479.png)



### 8.2 pushæ¨¡å¼æŒä¹…åŒ–åˆ°Nacosï¼ˆç”Ÿäº§æ¨èï¼‰

ä¸ä»…å¯ä»¥æ¨é€åˆ°Nacosä¹Ÿå¯ä»¥æ¨é€åˆ°``Zookeeperã€apolloã€redisã€consul``

**æ·»åŠ ä¾èµ–**

```yaml
<!--sentinelæ•°æ®æŒä¹…åŒ–Nacosæ•°æ®æº-->
<dependency>
    <groupId>com.alibaba.csp</groupId>
    <artifactId>sentinel-datasource-nacos</artifactId>
</dependency>
```

**application.yamlé…ç½®æŒä¹…åŒ–æ•°æ®æº**

```yaml
spring:
  cloud:
    sentinel:
        datasource:
          ds1:
            nacos:
              server-addr: ${spring.cloud.nacos.discovery.server-addr} #nacosåœ°å€
              dataId: ${spring.application.name}-rule #è¯¥æœåŠ¡sentinelè§„åˆ™é…ç½®çš„dataIdåç§°
              groupId: sentinel-rule #æ‰€åœ¨ç»„
              data-type: json #ç±»å‹  ä¸€å®šæ˜¯json
              rule-type: flow #é™æµ è¿™ä¸ªä¸é…åº”è¯¥ä¹Ÿå¯ä»¥
              namespace: 1a6b7567-f008-43dc-8c61-f7b805611eae #æ‰€å±å‘½åç©ºé—´
```

**åœ¨Nacosä¸­é…ç½®Sentinelè§„åˆ™**

é¡¹ç›®é…ç½®sentinelæ•°æ®æºä¸ºNacosåï¼Œåœ¨Sentinelåˆ›å»ºè§„åˆ™å¹¶ä¸ä¼šå‘é€åˆ°Nacosä¸­å­˜å‚¨ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨åœ¨Naocsé…ç½®ï¼Œç„¶åä»–ä¼šå®šæ—¶å»Nacosä¸­åŒæ­¥é…ç½®åˆ°å†…å­˜ä¸­ã€‚

![image-20210609184510201](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609184510201.png)

![image-20210609184519898](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609184519898.png)

æˆ‘ä»¬å¯ä»¥é€šè¿‡Sentinelçš„å®¡æŸ¥å…ƒç´ æŸ¥çœ‹åˆ›å»ºçš„è§„åˆ™è¯·æ±‚ä½“ä¸­çš„ è§„åˆ™jsonï¼Œç„¶åå¤åˆ¶è¿‡æ¥å°±å¯ä»¥äº†

**æµ‹è¯•**

é‡å¯æœåŠ¡ï¼ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨è¯¥é…ç½®

![image-20210609184532928](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609184532928.png)

åªä¸è¿‡å¾ˆéº»çƒ¦ï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡åœ¨Nacoså»é…ç½®Sentinelè§„åˆ™ï¼Œå› ä¸ºSentinelé…ç½®çš„è§„åˆ™ä¸ä¼šåŒæ­¥åˆ°Nacosä¸­

å®é™…ä¸­æˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šåœ¨Sentinelå»åˆ›å»ºè§„åˆ™ï¼Œç„¶åæ‰“å¼€å®¡æŸ¥å…ƒç´ ï¼ŒæŸ¥çœ‹sentinelå‘é€çš„è¯·æ±‚ä½“ï¼Œç„¶åå¤åˆ¶è¯·æ±‚ä½“ä¸­çš„è§„åˆ™jsonï¼Œç²˜è´´åˆ°nacosä¸­

![image-20210609184547799](https://cdn.jsdelivr.net/gh/EayonLee/IMG-Cloud@master/data/image-20210609184547799.png)

å¦‚æœæƒ³Sentinelåˆ›å»ºä¿®æ”¹è§„åˆ™ä¹‹åç›´æ¥æ¨é€åˆ°Nacoséœ€è¦ä¿®æ”¹sentinelæºç ï¼Œå¯ä»¥è‡ªè¡Œç™¾åº¦